<!DOCTYPE html>
<!--[if IE 8]><html class="no-js lt-ie9" lang="en"><![endif]-->
<!--[if gt IE 8]><!--><html class="no-js" lang="en"><!--<![endif]-->
<head>
<meta charset="utf-8">
<meta content="width=device-width, initial-scale=1.0" name="viewport">
<title>A Technical Odyssey</title>
<link href="http://zeuzoix.github.io/techeuphoria/stylesheets/app.css" rel="stylesheet">
<link href="/techeuphoria/feed.xml" rel="alternate" type="application/atom+xml">
<script src="http://zeuzoix.github.io/techeuphoria/javascripts/vendor/custom.modernizr.js"></script>
<link href="http://zeuzoix.github.io/techeuphoria/humans.txt" rel="author" type="text/plain">
</head>
<body class="antialiased">
<div class="fixed-width sticky">
<nav class="top-bar">
<ul class="title-area">
<li class="name">
<h1>
<a href="/techeuphoria/">
TechEuphoria
</a>
</h1>
</li>
<li class="toggle-topbar menu-icon">
<a href="#"><span></span></a>
</li>
</ul>
<section class="top-bar-section">
<ul class="left">
<li class="divider">
<li>
<a href="/techeuphoria/about/index.html">/about</a>
</li>
</li>
<li class="divider">
<li>
<a href="http://zeuzoix.github.io/techeuphoria/blog/index.html">/blog</a>
</li>
</li>
</ul>
</section>
</nav>
</div>
<div class="row">
<div class="large-12 columns">
<h1>TechEuphoria</h1>
<hr>
</div>
</div>
<div class="row" id="content">
<div class="large-9 columns">
<article class="post">
<header class="post-head">
<h1 class="title">
<a href="/techeuphoria/posts/2013/02/03/kernel-module-makefiles/">Kernel Module Makefiles</a>
</h1>
<h4>
<em>by</em>
<a class="author" href="http://in.linkedin.com/in/conradsjgomes">
Conrad Gomes
</a>
on
<time class="pubdate" datetime="2013-02-03T00:00:00+00:00">
February  3, 2013
</time>
</h4>
</header>
<div class="post-body">
<div id="preamble">
<div class="sectionbody">
<div class="paragraph">
<p>You&#8217;ve got your kernel module code ready and you want to build it. The following is a simple kernel module makefile which will help you
do this:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay"><code class="makefile language-makefile"><table class="CodeRay"><tr>
  <td class="line-numbers"><pre>1
2
3
4
5
6
7
</pre></td>
  <td class="code"><pre>obj-m += hello-1.o

all:
        make -C /lib/modules/$(shell uname -r)/build M=$(PWD) modules <i class="conum" data-value="1"></i><b>(1)</b>

clean:
        make -C /lib/modules/$(shell uname -r)/build M=$(PWD) clean <i class="conum" data-value="2"></i><b>(2)</b></pre></td>
</tr></table></code></pre>
</div>
</div>
<div class="colist arabic">
<table>
<tr>
<td><i class="conum" data-value="1"></i><b>1</b></td>
<td>modules is the target to build the kernel module</td>
</tr>
<tr>
<td><i class="conum" data-value="2"></i><b>2</b></td>
<td>clean is the target to clean the kernel module</td>
</tr>
</table>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="icon-note" title="Note"></i>
</td>
<td class="content">
The above makefile will fail if used directly please replace the spaces
at lines 4 and 7 with TABS or please download the following from here
<a href="https://docs.google.com/file/d/0B2qMThwa-F02dlBiaTl1dktTUWc/edit?usp=sharing" target="_blank">makefile1</a>.
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>In this explanation there are two makefiles which I will be referring to.
The first is the one shown above and the second is the main kernel makefile
which is located in the kernel source directory.</p>
</div>
<div class="paragraph">
<p>When you compile the kernel the make process assembles a list of kernel
drirvers and modules that are to be compiled as loadable kernel modules
defined by obj-m.</p>
</div>
<div class="paragraph">
<p>In our example above we indicate that we want to create a kernel module out
of the hello-1.o object file which is eventually built from our hello-1.c
source code.</p>
</div>
<div class="paragraph">
<p>There are two targets for the makefile i.e. all and clean. They invoke the
<em>'modules'</em> and <em>'clean'</em> targets of the main kernel makefile.</p>
</div>
<div class="paragraph">
<p>Let&#8217;s understand the option switches.</p>
</div>
<div class="paragraph">
<p>The <em>-C</em> option switches the make command to the kernel source directory.
Basically this is the directory of the source code used to build the kernel
image with the main kernel makefile. Here <em>$(shell uname -r)</em> is a convenient
way of specifying the name of the live kernel being run when the make
command is executed.</p>
</div>
<div class="paragraph">
<p>The <em>M</em> option tells the main kernel makefile to go to the present working
directory and read the makefile present there. This is a way of telling
the main kernel makefile to read the the makefile shown above. This enables
the main kernel makefile to add the <em>hello-1.o</em> object to its list of modules
to be built.</p>
</div>
<div class="paragraph">
<p>Here <em>$(PWD)</em> is a convenient way of specifying the present working directory.</p>
</div>
<div class="paragraph">
<p>More information is available at:<br>
<a href="http://www.tldp.org/LDP/lkmpg/2.6/html/x181.html" target="_blank">http://www.tldp.org/LDP/lkmpg/2.6/html/x181.html</a></p>
</div>
</div>
</div>
</div>
<footer class="post-footer">
<div class="tags"><i class="label icon-tags"></i>
<a href="/techeuphoria/posts/tag/kernel/">kernel</a>
, <a href="/techeuphoria/posts/tag/linux/">linux</a>
, <a href="/techeuphoria/posts/tag/programming/">programming</a></div>
</footer>
<hr>
</article>


</div>
<div class="large-3 columns">
<h4>Topics</h4>
<ul class="square">
<li>
<a href="/techeuphoria/posts/tag/arm/">arm</a>
</li>
<li>
<a href="/techeuphoria/posts/tag/asciidoc/">asciidoc</a>
</li>
<li>
<a href="/techeuphoria/posts/tag/asciidoctor/">asciidoctor</a>
</li>
<li>
<a href="/techeuphoria/posts/tag/awestruct/">awestruct</a>
</li>
<li>
<a href="/techeuphoria/posts/tag/blog/">blog</a>
</li>
<li>
<a href="/techeuphoria/posts/tag/bus/">bus</a>
</li>
<li>
<a href="/techeuphoria/posts/tag/c/">c</a>
</li>
<li>
<a href="/techeuphoria/posts/tag/cache/">cache</a>
</li>
<li>
<a href="/techeuphoria/posts/tag/cortex/">cortex</a>
</li>
<li>
<a href="/techeuphoria/posts/tag/design/">design</a>
</li>
<li>
<a href="/techeuphoria/posts/tag/electronics/">electronics</a>
</li>
<li>
<a href="/techeuphoria/posts/tag/github pages/">github pages</a>
</li>
<li>
<a href="/techeuphoria/posts/tag/i2c/">i2c</a>
</li>
<li>
<a href="/techeuphoria/posts/tag/kernel/">kernel</a>
</li>
<li>
<a href="/techeuphoria/posts/tag/linux/">linux</a>
</li>
<li>
<a href="/techeuphoria/posts/tag/processors/">processors</a>
</li>
<li>
<a href="/techeuphoria/posts/tag/productization/">productization</a>
</li>
<li>
<a href="/techeuphoria/posts/tag/programming/">programming</a>
</li>
<li>
<a href="/techeuphoria/posts/tag/protocols/">protocols</a>
</li>
<li>
<a href="/techeuphoria/posts/tag/twi/">twi</a>
</li>
<li>
<a href="/techeuphoria/posts/tag/website/">website</a>
</li>
<li>
<a href="/techeuphoria/posts/tag/www/">www</a>
</li>
</ul>
</div>
</div>
<footer class="row" style="max-width: 100%">
<hr>
<div class="large-6 columns">
<p style="margin-bottom: .75em">
&copy; conrad.s.j.gomes@gmail.com 2014
<br>
Built on Foundation. Baked by Awestruct. Composed with Asciidoc
</p>
</div>
<div class="large-6 columns">
<ul class="inline-list right">
<li>
<a href="http://zeuzoix.github.io/techeuphoria/">Home</a>
</li>
</ul>
</div>
</footer>
<script>
document.write('<script src=' + ('__proto__' in {} ? 'http://zeuzoix.github.io/techeuphoria/javascripts/vendor/zepto' : 'http://zeuzoix.github.io/techeuphoria/javascripts/vendor/jquery') + '.js><\/script>')
</script>
<script src="http://zeuzoix.github.io/techeuphoria/javascripts/foundation/foundation.js"></script>
<script src="http://zeuzoix.github.io/techeuphoria/javascripts/foundation/foundation.topbar.js"></script>
<script>
$(document).foundation()
</script>
</body>
</html>
