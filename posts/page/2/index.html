<!DOCTYPE html>
<!--[if IE 8]><html class="no-js lt-ie9" lang="en"><![endif]-->
<!--[if gt IE 8]><!--><html class="no-js" lang="en"><!--<![endif]-->
<head>
<meta charset="utf-8">
<meta content="width=device-width, initial-scale=1.0" name="viewport">
<title>A Technical Odyssey</title>
<link href="http://zeuzoix.github.io/techeuphoria/stylesheets/app.css" rel="stylesheet">
<link href="/techeuphoria/feed.xml" rel="alternate" type="application/atom+xml">
<script src="http://zeuzoix.github.io/techeuphoria/javascripts/vendor/custom.modernizr.js"></script>
<link href="http://zeuzoix.github.io/techeuphoria/humans.txt" rel="author" type="text/plain">
</head>
<body class="antialiased">
<div class="fixed-width">
<nav class="top-bar">
<ul class="title-area">
<li class="name">
<h1>
<a href="/techeuphoria/">
TechEuphoria
</a>
</h1>
</li>
<li class="toggle-topbar menu-icon">
<a href="#"><span></span></a>
</li>
</ul>
<section class="top-bar-section">
<ul class="left">
<li class="divider">
<li>
<a href="/techeuphoria/quests/index.html">/quests</a>
</li>
</li>
<li class="divider"></li>
</ul>
</section>
</nav>
</div>
<div class="row">
<div class="large-12 columns">
<h1></h1>
</div>
</div>
<div class="row" id="content">
<div class="large-12 columns">
<div class="row">
<div class="large-12 columns posts">
<article class="post">
<header class="post-head">
<h1 class="title">
<a href="/techeuphoria/posts/2013/09/07/i2c-twi-with-avr-data-transfer/">I2C/TWI with AVR Data Transfer</a>
</h1>
<h4>
<em>by</em>
<a class="author" href="http://in.linkedin.com/in/conradsjgomes">
Conrad Gomes
</a>
on
<time class="pubdate" datetime="2013-09-07T00:00:00+00:00">
September  7, 2013
</time>
</h4>
</header>
<div class="post-body">
<div class="paragraph">
<p>We now take a look at the TWI/I2C API responsible for data transfer. The header file
<a href="https://github.com/zeuzoix/sardine/blob/master/twi.h">twi.h</a> has the prototype. We&#8217;ll take a look at the arguments and
their description now:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="c">TWI_RET_E twi_send_recv_buffer(
                           TWI_SEND_RECV_BUFFER_PARAMS_X *px_send_buffer_params,
                           TWI_MODE_E e_mode);</code></pre>
</div>
</div>
<div class="paragraph">
<p>The first argument is a pointer to TWI_SEND_RECV_BUFFER_PARAMS_X defined as follows:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="c"><span style="color:#080;font-weight:bold">typedef</span> <span style="color:#080;font-weight:bold">struct</span> _TWI_SEND_RECV_BUFFER_PARAMS_X
{
   uint8_t uc_dev_addr;
   uint8_t uc_dev_id;
   uint8_t *puc_reg_addr;
   uint32_t ui_reg_addr_sz;
   uint8_t *puc_data;
   uint32_t ui_data_sz;

}TWI_SEND_RECV_BUFFER_PARAMS_X;</code></pre>
</div>
</div>
<div class="paragraph">
<p>Where</p>
</div>
<div class="olist arabic">
<ol class="arabic">
<li>
<p><strong>uc_dev_addr</strong> is the higher nibble of the I2C slave device address</p>
</li>
<li>
<p><strong>uc_dev_id</strong> is the lower nibble of the I2C slave device address. It is used where the slave address can be configured</p>
</li>
<li>
<p><strong>puc_reg_addr</strong> is the pointer to the buffer holding the register address of the slave device.</p>
</li>
<li>
<p><strong>ui_reg_addr_sz</strong> is the size of the buffer with the register address.</p>
</li>
<li>
<p><strong>puc_data</strong> is the pointer to the data buffer</p>
</li>
<li>
<p><strong>ui_data_sz</strong> is the size of the data buffer.</p>
</li>
</ol>
</div>
<div class="paragraph">
<p>The second argument is an enumeration which indicates if a send or receive operation is to be done</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="c"><span style="color:#080;font-weight:bold">typedef</span> <span style="color:#080;font-weight:bold">enum</span> _TWI_STATE_MODE_E
{
   eTWI_MODE_READ = <span style="color:#00D">0</span>,
   eTWI_MODE_WRITE,
   eTWI_MODE_INVALID

}TWI_MODE_E;</code></pre>
</div>
</div>
</div>
<footer class="post-footer">
<div class="tags"><i class="label icon-tags"></i>
<a href="/techeuphoria/posts/tag/electronics/">electronics</a>
, <a href="/techeuphoria/posts/tag/productization/">productization</a>
, <a href="/techeuphoria/posts/tag/i2c/">i2c</a></div>
</footer>
<hr>
</article>

<article class="post">
<header class="post-head">
<h1 class="title">
<a href="/techeuphoria/posts/2013/08/31/i2c-twi-with-avr-register-initialization/">I2C/TWI with AVR Register Initialization</a>
</h1>
<h4>
<em>by</em>
<a class="author" href="http://in.linkedin.com/in/conradsjgomes">
Conrad Gomes
</a>
on
<time class="pubdate" datetime="2013-08-31T00:00:00+00:00">
August 31, 2013
</time>
</h4>
</header>
<div class="post-body">
<div class="paragraph">
<p>We learned about the different registers available in the Atmel AVR microcontroller to program the TWI interface. In this section we&#8217;ll go through the twi_init API and the initialization of the TWI interface.</p>
</div>
<div class="paragraph">
<p>The initialization code in the <a href="https://github.com/zeuzoix/sardine/blob/master/testbench.c">testbench.c</a> initializes the
TWI/I2C library as follows:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="c">x_twi_init_params.e_mode = eTWI_INIT_MODE_16_0000M_100K_1;
x_twi_init_params.pfn_debug = testbench_debug;
e_twi_ret = twi_init(&amp;x_twi_init_params);
<span style="color:#080;font-weight:bold">if</span>(eTWI_SUCCESS != e_twi_ret)
{
   i_ret = -<span style="color:#00D">1</span>;
   <span style="color:#080;font-weight:bold">goto</span> LBL_INIT_IO_RET;
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>The API <em>twi_init</em> takes a structure variable x_twi_init_params of the type
shown below.  The definition is in <a href="https://github.com/zeuzoix/sardine/blob/master/twi.h">twi.h</a>:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="c"><span style="color:#080;font-weight:bold">typedef</span> <span style="color:#080;font-weight:bold">struct</span> _TWI_INIT_PARAMS_X
{
   TWI_INIT_MODE_E e_mode;
   TWI_DEBUG_PFN pfn_debug;

}TWI_INIT_PARAMS_X;</code></pre>
</div>
</div>
<div class="paragraph">
<p>The TWI interface can be initialized based on several modes each of which
is given an identifier which signifies the CPU clock frequency, SCL clock
speed and the pre-scaler value. For instance in the enumeration definition
below <em>eTWI_INIT_MODE_16_0000M_100K_1</em> is the mode for a 16.0000MHz
micro-controller, with the desired SCL clock frequency set at 100KHz and
the pre-scaler set to 1.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="c"><span style="color:#080;font-weight:bold">typedef</span> <span style="color:#080;font-weight:bold">enum</span> _TWI_INIT_MODE_E
{
   eTWI_INIT_MODE_16_0000M_100K_1 = <span style="color:#00D">0</span>,
   eTWI_INIT_MODE_16_0000M_400K_1,
   eTWI_INIT_MODE_16_0000M_100K_4,
   eTWI_INIT_MODE_16_0000M_400K_4,
   eTWI_INIT_MODE_INVALID

}TWI_INIT_MODE_E;</code></pre>
</div>
</div>
<div class="paragraph">
<p>Internally if we take a look at the twi_init function defined in
<a href="https://github.com/zeuzoix/sardine/blob/master/twi.c">twi.c</a> we see a look up table is employed to initialize the
5 registers TWBR, TWCR, TWSR, TWDR, TWAR. The look up table has the
following structure for each row:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="c"><span style="color:#080;font-weight:bold">typedef</span> <span style="color:#080;font-weight:bold">struct</span> _TWI_INIT_REG_X
{
   TWI_INIT_MODE_E e_mode;
   uint8_t uc_twbr;
   uint8_t uc_twcr;
   uint8_t uc_twsr;
   uint8_t uc_twdr;
   uint8_t uc_twar;

}TWI_INIT_REG_X;</code></pre>
</div>
</div>
<div class="paragraph">
<p>The lookup table is a global array gxa_init_reg and is defined as follows:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="c"><span style="color:#088;font-weight:bold">static</span> TWI_INIT_REG_X gxa_init_reg[] =
{
   {
      eTWI_INIT_MODE_16_0000M_100K_1,
      <span style="color:#02b">0x48</span>,                               <span style="color:#777">//0b01001000</span>
      <span style="color:#02b">0x80</span>,                               <span style="color:#777">//0b10000000</span>
      <span style="color:#02b">0x00</span>,                               <span style="color:#777">//0b00000000</span>
      <span style="color:#02b">0x00</span>,                               <span style="color:#777">//0b00000000</span>
      <span style="color:#02b">0x00</span>                                <span style="color:#777">//0b00000000</span>
   }
};</code></pre>
</div>
</div>
<div class="paragraph">
<p>The code in twi_init cycles through the array gxa_init_reg until it finds
the correct mode and then initializes the 5 registers with the values associated
with the mode.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="c"><span style="color:#080;font-weight:bold">for</span>(uc_i = <span style="color:#00D">0</span> ; uc_i &lt; uc_size_arr ; uc_i++)
{
   <span style="color:#080;font-weight:bold">if</span>(px_init_params-&gt;e_mode == gxa_init_reg[uc_i].e_mode)
   {
      px_init_reg = &amp;gxa_init_reg[uc_i];
      <span style="color:#080;font-weight:bold">break</span>;
   }
}

<span style="color:#080;font-weight:bold">if</span>(<span style="color:#069">NULL</span> == px_init_reg)
{
   <span style="color:#080;font-weight:bold">if</span>(<span style="color:#069">NULL</span> != px_init_params-&gt;pfn_debug)
   {
      px_init_params-&gt;pfn_debug(<span style="background-color:hsla(0,100%,50%,0.05)"><span style="color:#710">&quot;</span><span style="color:#D20">Can't find correct mode</span><span style="color:#710">&quot;</span></span>);
   }

   e_ret = eTWI_FAILURE;
   <span style="color:#080;font-weight:bold">goto</span> LBL_TWI_INIT_RET;
}

TWBR = px_init_reg-&gt;uc_twbr;
TWCR = px_init_reg-&gt;uc_twcr;
TWSR = px_init_reg-&gt;uc_twsr;
TWDR = px_init_reg-&gt;uc_twdr;
TWAR = px_init_reg-&gt;uc_twar;</code></pre>
</div>
</div>
<div class="paragraph">
<p>In the <a href="http://zeuzoix.github.io/techeuphoria/posts/2013/09/07/i2c-twi-with-avr-data-transfer/">next</a> section we&#8217;ll check out transmit
and receive functionality on the TWI/I2C bus with I2C/TWI with AVR Data Transfer.</p>
</div>
</div>
<footer class="post-footer">
<div class="tags"><i class="label icon-tags"></i>
<a href="/techeuphoria/posts/tag/electronics/">electronics</a>
, <a href="/techeuphoria/posts/tag/protocols/">protocols</a>
, <a href="/techeuphoria/posts/tag/i2c/">i2c</a>
, <a href="/techeuphoria/posts/tag/twi/">twi</a>
, <a href="/techeuphoria/posts/tag/bus/">bus</a></div>
</footer>
<hr>
</article>

<article class="post">
<header class="post-head">
<h1 class="title">
<a href="/techeuphoria/posts/2013/08/29/i2c-twi-with-avr-register-descriptions/">I2C/TWI with AVR Register Descriptions</a>
</h1>
<h4>
<em>by</em>
<a class="author" href="http://in.linkedin.com/in/conradsjgomes">
Conrad Gomes
</a>
on
<time class="pubdate" datetime="2013-08-29T00:00:00+00:00">
August 29, 2013
</time>
</h4>
</header>
<div class="post-body">
<div id="preamble">
<div class="sectionbody">
<div class="paragraph">
<p>So you want to program the TWI/I2C interface of the AVR. Well you&#8217;ll need to read up about the registers used to control this interface. Though the microcontroller uses two pins SDA and SDC to drive the bus
there is a bunch of registers which are used to control the pins themselves.
Let&#8217;s take a look at them.</p>
</div>
</div>
</div>
<div class="sect1">
<h2 id="twi-bit-rate-register-twbr"><a class="anchor" href="#twi-bit-rate-register-twbr"></a>TWI Bit Rate Register (TWBR)</h2>
<div class="sectionbody">
<div class="paragraph">
<p>This register controls the SCL clock frequency which can either be 100Hz or
400Hz.</p>
</div>
<div class="exampleblock">
<div class="content">
<div id="TWI_TBR" class="imageblock" style="text-align: center">
<div class="content">
<a class="image" href="../../../../../images/TWI_TWBR.png"><img src="http://zeuzoix.github.io/techeuphoria/images/TWI_TWBR.png" alt="TWI TWBR" width="640" height="480"></a>
</div>
<div class="title">Figure 1. TWI bit rate register map</div>
</div>
</div>
</div>
<div class="paragraph">
<p>The equation to set the correct SCL clock frequency is:</p>
</div>
<div class="exampleblock">
<div class="content">
<div id="Clock-Frequency-Equation" class="imageblock" style="text-align: left">
<div class="content">
<img src="http://zeuzoix.github.io/techeuphoria/images/svg.latex.svg" alt="svg.latex">
</div>
<div class="title">Figure 2. SCL clock frequency equation</div>
</div>
</div>
</div>
<div class="olist arabic">
<ol class="arabic">
<li>
<p><strong>CPUclockfreq</strong> is the CPU clock frequency(16MHz in my case).</p>
</li>
<li>
<p><strong>SCLfreq</strong> is the desired SCL clock frequency(100Hz in my case).</p>
</li>
<li>
<p><strong>TWBR</strong> is the value we store in the register.</p>
</li>
<li>
<p><strong>TWPS</strong> is the prescaler bits in the TWI status register TWSR which can take
values from 0 to 3(0 in my case).</p>
</li>
</ol>
</div>
</div>
</div>
<div class="sect1">
<h2 id="twi-control-register-twcr"><a class="anchor" href="#twi-control-register-twcr"></a>TWI Control Register (TWCR)</h2>
<div class="sectionbody">
<div class="paragraph">
<p>This register is used to control the operation of the TWI/I2C interface. Start
or stop a transaction and acknowledge the receipt of a data packet.</p>
</div>
<div class="exampleblock">
<div class="content">
<div id="TWI_TWCR" class="imageblock" style="text-align: center">
<div class="content">
<a class="image" href="../../../../../images/TWI_TWCR.png"><img src="http://zeuzoix.github.io/techeuphoria/images/TWI_TWCR.png" alt="TWI TWCR" width="640" height="480"></a>
</div>
<div class="title">Figure 3. TWI control register map</div>
</div>
</div>
</div>
<div class="olist arabic">
<ol class="arabic">
<li>
<p><strong>Bit 7 - TWINT:</strong> Set when the TWI has finished it&#8217;s task. Also used to initiate
a transaction. This flag is normally cleared by writing a 1 to it. All other
operations to the TWDR and TWAR must be done before this is cleared.</p>
</li>
<li>
<p><strong>Bit 6 - TWEA:</strong> Controls generation of the acknowledge bit.</p>
</li>
<li>
<p><strong>Bit 5 - TWSTA:</strong> Controls generation of a start bit.</p>
</li>
<li>
<p><strong>Bit 4 - TWSTO:</strong> Controls generation of a stop bit.</p>
</li>
<li>
<p><strong>Bit 3 - TWWC:</strong> This is a read only bit. It is set if you write TWDR when TWINT
is low. It is reset if you write TWDR when TWINT is high.</p>
</li>
<li>
<p><strong>Bit 2 - TWEN:</strong> This bit enables the TWI/I2C interface</p>
</li>
<li>
<p><strong>Bit 0 - TWIE:</strong> This bit in conjunction with the I-bit in SREG enables the
interrupt mode</p>
</li>
</ol>
</div>
</div>
</div>
<div class="sect1">
<h2 id="twi-status-register-twsr"><a class="anchor" href="#twi-status-register-twsr"></a>TWI Status Register (TWSR)</h2>
<div class="sectionbody">
<div class="paragraph">
<p>After every operation of the TWI interface this register is read to understand the
status of the bus.</p>
</div>
<div class="exampleblock">
<div class="content">
<div id="TWI_TWSR" class="imageblock" style="text-align: center">
<div class="content">
<a class="image" href="../../../../../images/TWI_TWSR.png"><img src="http://zeuzoix.github.io/techeuphoria/images/TWI_TWSR.png" alt="TWI TWSR" width="640" height="480"></a>
</div>
<div class="title">Figure 4. TWI status register map</div>
</div>
</div>
</div>
<div class="olist arabic">
<ol class="arabic">
<li>
<p><strong>Bits 7:3 - TWS7:TWS3:</strong> Status of the last TWI/I2C transaction</p>
</li>
<li>
<p><strong>Bits 1:0 - TWPS1:TWPS0:</strong> These are the pre-scaler bits used to modify the SCL frequency.</p>
</li>
</ol>
</div>
</div>
</div>
<div class="sect1">
<h2 id="twi-data-register-twdr"><a class="anchor" href="#twi-data-register-twdr"></a>TWI Data Register (TWDR)</h2>
<div class="sectionbody">
<div class="paragraph">
<p>This register is used to stores the bytes to be transmitted or the bytes received
on the TWI bus.</p>
</div>
<div class="exampleblock">
<div class="content">
<div id="TWI_TWDR" class="imageblock" style="text-align: center">
<div class="content">
<a class="image" href="../../../../../images/TWI_TWDR.png"><img src="http://zeuzoix.github.io/techeuphoria/images/TWI_TWDR.png" alt="TWI TWDR" width="640" height="480"></a>
</div>
<div class="title">Figure 5. TWI data register map</div>
</div>
</div>
</div>
<div class="olist arabic">
<ol class="arabic">
<li>
<p><strong>Bits 7:0 - TWD7:TWD0:</strong> Data byte to be written to the TWI bus or read from the TWI bus.</p>
</li>
</ol>
</div>
</div>
</div>
<div class="sect1">
<h2 id="twi-address-register-twar"><a class="anchor" href="#twi-address-register-twar"></a>TWI Address Register (TWAR)</h2>
<div class="sectionbody">
<div class="paragraph">
<p>This register is loaded with the 7 bit Slave address to which it must respond
to when programmed as a slave or when working in a multiple master mode. In
the multiple master mode the device will compete to be a master and if it senses
that it has lost the arbitration of the line it will have to turn into a slave
and listen for a possible message from another master device.</p>
</div>
<div class="exampleblock">
<div class="content">
<div id="TWI_TWAR" class="imageblock" style="text-align: center">
<div class="content">
<a class="image" href="../../../../../images/TWI_TWAR.png"><img src="http://zeuzoix.github.io/techeuphoria/images/TWI_TWAR.png" alt="TWI TWAR" width="640" height="480"></a>
</div>
<div class="title">Figure 6. TWI address register map</div>
</div>
</div>
</div>
<div class="olist arabic">
<ol class="arabic">
<li>
<p><strong>Bits 7:1 - TWA6: TWA0:</strong> 7 bit slave address of the TWI interface.</p>
</li>
<li>
<p><strong>Bit 0 - TWGCE:</strong> Indicates if the device will acknowledge a general call when
sent. A general call is an address to all the slaves connected on the bus. The
Slave address for a general call is usually all 0s.</p>
</li>
</ol>
</div>
<div class="paragraph">
<p>In the <a href="http://zeuzoix.github.io/techeuphoria/posts/2013/08/31/i2c-twi-with-avr-register-initialization/">next</a> section I2C/TWI with AVR
Register Intialization we&#8217;ll go through the initialization code for the TWI/I2C
interface and the values assigned to these registers.</p>
</div>
</div>
</div>
</div>
<footer class="post-footer">
<div class="tags"><i class="label icon-tags"></i>
<a href="/techeuphoria/posts/tag/electronics/">electronics</a>
, <a href="/techeuphoria/posts/tag/protocols/">protocols</a>
, <a href="/techeuphoria/posts/tag/i2c/">i2c</a>
, <a href="/techeuphoria/posts/tag/twi/">twi</a>
, <a href="/techeuphoria/posts/tag/bus/">bus</a></div>
</footer>
<hr>
</article>

<article class="post">
<header class="post-head">
<h1 class="title">
<a href="/techeuphoria/posts/2013/08/25/i2c-twi-with-avr-introduction/">I2C/TWI with AVR Introduction</a>
</h1>
<h4>
<em>by</em>
<a class="author" href="http://in.linkedin.com/in/conradsjgomes">
Conrad Gomes
</a>
on
<time class="pubdate" datetime="2013-08-25T00:00:00+00:00">
August 25, 2013
</time>
</h4>
</header>
<div class="post-body">
<div class="paragraph">
<p>In this post we&#8217;ll take a look at implementing an I2C/TWI library which can be used with Atmel&#8217;s AVR micro-controller.</p>
</div>
<div class="paragraph">
<p>The code has been uploaded to GitHub at <a href="https://github.com/zeuzoix/sardine" class="bare">https://github.com/zeuzoix/sardine</a> and will be
referenced here. The TWI library consists of the following files:</p>
</div>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>twi.h</p>
</li>
<li>
<p>twi.c</p>
</li>
<li>
<p>twi_states.h</p>
</li>
<li>
<p>twi_states.c</p>
</li>
<li>
<p>twi_debug.h</p>
</li>
</ol>
</div>
<div class="paragraph">
<p>There are two API which the application can use to interface with the I2C/TWI
interface. The prototypes are in twi.h</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="c">   uint32_t ui_data_sz;

}TWI_SEND_RECV_BUFFER_PARAMS_X;


TWI_RET_E twi_init(TWI_INIT_PARAMS_X *px_init_params);
TWI_RET_E twi_send_recv_buffer(TWI_SEND_RECV_BUFFER_PARAMS_X *px_send_buffer_params,
                               TWI_MODE_E e_mode);

<span style="color:#579">#endif</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>The first API <em>twi_init</em> is used to initialize the TWI interface in master
mode by assigning a set of register values to the TWI registers in the AVR Atmel
micro-controller.</p>
</div>
<div class="paragraph">
<p>The second API <em>twi_send_recv_buffer</em> is used in both transmit and receive mode
to send and receive data over the TWI SDA data line.</p>
</div>
<div class="paragraph">
<p>We&#8217;ll take a look at the registers used in the programming of the TWI interface
in the next section i.e.</p>
</div>
<div class="paragraph">
<p><a href="http://zeuzoix.github.io/techeuphoria/posts/2013/08/29/i2c-twi-with-avr-register-descriptions/">I2C/TWI with AVR Register Descriptions</a>.</p>
</div>
</div>
<footer class="post-footer">
<div class="tags"><i class="label icon-tags"></i>
<a href="/techeuphoria/posts/tag/electronics/">electronics</a>
, <a href="/techeuphoria/posts/tag/protocols/">protocols</a>
, <a href="/techeuphoria/posts/tag/i2c/">i2c</a>
, <a href="/techeuphoria/posts/tag/twi/">twi</a>
, <a href="/techeuphoria/posts/tag/bus/">bus</a></div>
</footer>
<hr>
</article>

<article class="post">
<header class="post-head">
<h1 class="title">
<a href="/techeuphoria/posts/2013/05/23/git/">GIT</a>
</h1>
<h4>
<em>by</em>
<a class="author" href="http://in.linkedin.com/in/conradsjgomes">
Conrad Gomes
</a>
on
<time class="pubdate" datetime="2013-05-23T00:00:00+00:00">
May 23, 2013
</time>
</h4>
</header>
<div class="post-body">
<div class="paragraph">
<p>I&#8217;ve been a SVN user for quite some time. However it&#8217;s good to understand why GIT has risen in popularity.</p>
</div>
<div class="paragraph">
<p>GIT was developed by the same team that developed Linux. Key differences as
compared to other version control systems</p>
</div>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>Distributed: Everyone gets access to the repository on their system unlike
other version control systems which have a central repository on a server.
The main advantage being that even if network access is not available you
can still interact with the version control system.</p>
</li>
<li>
<p>Snapshots: A version of a file is the snapshot of the file at that point
in time. It is not the sum of all differences. Basically the smallest unit
of change is a file.</p>
</li>
</ol>
</div>
<div class="paragraph">
<p>URLs that I found useful:<br>
Setup: <a href="https://help.github.com/articles/set-up-git" class="bare">https://help.github.com/articles/set-up-git</a><br>
Design Basics: <a href="http://git-scm.com/book/en/Getting-Started-Git-Basics" class="bare">http://git-scm.com/book/en/Getting-Started-Git-Basics</a><br>
Test Run: <a href="http://try.github.io/levels/1/challenges/1" class="bare">http://try.github.io/levels/1/challenges/1</a><br></p>
</div>
</div>
<footer class="post-footer">
<div class="tags"><i class="label icon-tags"></i>
<a href="/techeuphoria/posts/tag/git/">git</a></div>
</footer>
<hr>
</article>

<article class="post">
<header class="post-head">
<h1 class="title">
<a href="/techeuphoria/posts/2013/05/18/real-time-clock-with-ds1307-register-map-description/">Real Time Clock with DS1307 - Register Map Description</a>
</h1>
<h4>
<em>by</em>
<a class="author" href="http://in.linkedin.com/in/conradsjgomes">
Conrad Gomes
</a>
on
<time class="pubdate" datetime="2013-05-18T08:18:00+05:30">
May 18, 2013
</time>
</h4>
</header>
<div class="post-body">
<div class="paragraph">
<p>In the <a href="http://zeuzoix.github.io/techeuphoria/posts/2013/05/12/an-introduction-to-i2c/" target="_blank">first part</a> we went through a brief introduction of the
DS1307 chip.<br>
We know the DS1307 can be programmed via the I2C bus i.e SDA and SCL. Through
I2C we should be able to address the registers of this chip and write and read
data based on our application description.</p>
</div>
<div class="paragraph">
<p>The internal registers which affect the behaviour of the RTC chip are as follows:</p>
</div>
<div class="exampleblock">
<div class="content">
<div id="DS1307_RegisterMap" class="imageblock" style="text-align: center">
<div class="content">
<a class="image" href="../../../../../images/DS1307_RegisterMap.png"><img src="http://zeuzoix.github.io/techeuphoria/images/DS1307_RegisterMap.png" alt="DS1307 RegisterMap" width="640" height="480"></a>
</div>
<div class="title">Figure 1. Register map of the DS1307 RTC</div>
</div>
</div>
</div>
<div class="paragraph">
<p>The first 7 registers are used to read and write the time and date.
Registers 00h and 01h have more or less the same byte definition and
this is mainly because there are 60 seconds and 60 minutes.</p>
</div>
<div class="paragraph">
<p>An important difference is bit 7 of register 00h which is the clock halt bit.
By default this bit is set to 1 on power up of the device which disables the
oscillator and RTC functionality of the DS1307.</p>
</div>
<div class="paragraph">
<p>All values are in binary coded decimal. The range of seconds and minutes goes
from 00 to 59. Therefore for the minutes and seconds we have bits 0 to 3
representing the lower digit i.e. 0 to 9 and bits 4 to 6 representing the
higher digit.</p>
</div>
<div class="paragraph">
<p>The representation of hours can be in the form of either 12 or 24 hour notation.
Bit 6 indicates the notation used. When high the 12 hour notation is used and
bit 5 indicates AM/PM with high being PM. In this case the range of values goes
from 01 to 12. Therefore we have bits 0 to 3 representing the lower digits i.e.
0 to 9 and bit 4 representing the higher digit i.e. 0 or 1.</p>
</div>
<div class="paragraph">
<p>In the 24 hour notation the range of values goes from 00 to 23. Therefore the
lower digit representation remains the same i.e. 0 to 9 represented by bits 0
to 3 but bits 4 and 5 are used to represent the higher digit i.e. 0 to 2.</p>
</div>
<div class="paragraph">
<p>Essentially the number of bits reserved for each digit is defined by the
range of the value. For instance there are only 7 possible days and so we
have 3 bits representing the day of the week in register 03h. And if we look
at the date register 04h we see the range of values goes from 01 to 31
therefore the lower digit of the date can have a maximum value of 9 so four
bits are reserved whereas the upper digit can have a maximum value of 3
therefore 2 bits are reserved.</p>
</div>
<div class="paragraph">
<p>Registers 05h and 06h follow the same pattern. Register 07h controls the
behaviour of the square wave out signal. Bit 4 controls the functionality
i.e. whether the pin produces a square wave or a fixed ouput. By default
the value is 0 causing the pin to output a fixed value governed by the
bit 7. If bit 4 is set to 1 the pin produces a square wave whose frequency
is controlled by bits 0 and 1. The number of possible combinations is 4
with 2 bits and therefore the possibilities are 1Hz, 4.096kHz, 8.192kHz
and 32.768kHz.</p>
</div>
<div class="paragraph">
<p>Registers 08h to 3Fh provide a 56x8 RAM area for use by the application.
For further information please go through the data sheet at:
<a href="http://datasheets.maximintegrated.com/en/ds/DS1307.pdf" target="_blank">ds1307-maximintegrated-pdf</a></p>
</div>
</div>
<footer class="post-footer">
<div class="tags"><i class="label icon-tags"></i>
<a href="/techeuphoria/posts/tag/electronics/">electronics</a>
, <a href="/techeuphoria/posts/tag/productization/">productization</a>
, <a href="/techeuphoria/posts/tag/i2c/">i2c</a></div>
</footer>
<hr>
</article>

<article class="post">
<header class="post-head">
<h1 class="title">
<a href="/techeuphoria/posts/2013/05/18/real-time-clock-with-ds1307-introduction/">Real Time Clock with DS1307 - Introduction</a>
</h1>
<h4>
<em>by</em>
<a class="author" href="http://in.linkedin.com/in/conradsjgomes">
Conrad Gomes
</a>
on
<time class="pubdate" datetime="2013-05-18T08:08:00+05:30">
May 18, 2013
</time>
</h4>
</header>
<div class="post-body">
<div class="paragraph">
<p>You&#8217;re developing a product and you need it to track time even when the power is switched off, what do you use? A real-time clock.</p>
</div>
<div class="paragraph">
<p>A real-time clock(RTC) for your system can be made available using chips like
the <a href="http://www.maximintegrated.com/en/products/digital/real-time-clocks/DS1307.html" target="_blank">DS1307</a>. This has the ability to be
programmed and keep track of the time in seconds, minutes, hours and date in
binary coded decimal(BCD) format with compensation for leap years till 2100.</p>
</div>
<div class="paragraph">
<p>The DS1307 on inspection has 8 pins. The following describes the kind of
circuit connections required for this chip.</p>
</div>
<div class="exampleblock">
<div class="content">
<div id="Circuit_Diagram_DS1307" class="imageblock" style="text-align: center">
<div class="content">
<a class="image" href="../../../../../images/Circuit_Diagram_DS1307.gif"><img src="http://zeuzoix.github.io/techeuphoria/images/Circuit_Diagram_DS1307.gif" alt="Circuit Diagram DS1307" width="640" height="480"></a>
</div>
<div class="title">Figure 1. Circuit diagram of DS1307</div>
</div>
</div>
</div>
<div class="paragraph">
<p>Starting at the top left we see pins X1 and X2 connected to a crystal.
The crystal provides the clock to the chip and is critical in accurately
maintaining the time once programmed. Connections for X1 and X2 is a standard
32.768kHz quartz crystal.</p>
</div>
<div class="paragraph">
<p>The VCC and GND provide the power supply to the chip which is a 5V power
supply.</p>
</div>
<div class="paragraph">
<p>SQW/OUT has dual functionality. It can be used to generate a square wave of
1Hz, 4kHz, 8kHz and 32kHz or it can simply output either a high or low
signal.</p>
</div>
<div class="paragraph">
<p>VBAT is the connection for an external battery. The chip has an automatic
power fail detect and switch circuitry which will switch to the battery
in the event of the main power supply failing.</p>
</div>
<div class="paragraph">
<p>SDA and SCL are the I2C lines which is used by the CPU/Micro-controller to
read and write the time and date registers.</p>
</div>
<div class="paragraph">
<p>In the next part we look at the register map of the DS1307.</p>
</div>
<div class="paragraph">
<p><a href="http://zeuzoix.github.io/techeuphoria/posts/2013/08/29/i2c-twi-with-avr-register-descriptions/" target="_blank">Next: Real Time Clock with DS1307 Register Map Description</a></p>
</div>
</div>
<footer class="post-footer">
<div class="tags"><i class="label icon-tags"></i>
<a href="/techeuphoria/posts/tag/electronics/">electronics</a>
, <a href="/techeuphoria/posts/tag/productization/">productization</a>
, <a href="/techeuphoria/posts/tag/i2c/">i2c</a></div>
</footer>
<hr>
</article>

<article class="post">
<header class="post-head">
<h1 class="title">
<a href="/techeuphoria/posts/2013/05/14/atmega-development-boards-and-arduino/">Atmega Development Boards and Arduino</a>
</h1>
<h4>
<em>by</em>
<a class="author" href="http://in.linkedin.com/in/conradsjgomes">
Conrad Gomes
</a>
on
<time class="pubdate" datetime="2013-05-14T00:00:00+00:00">
May 14, 2013
</time>
</h4>
</header>
<div class="post-body">
<div class="paragraph">
<p>I&#8217;ve been going through various sources trying to figure out what the Electronic DIY community uses to develop LED cubes, RC controlled cars, etc.
I&#8217;ve been going through various sources trying to figure out what the Electronic
DIY community uses to develop <a href="http://youtu.be/WZfNS-pbFYQ" target="_blank">LED cubes</a>,
<a href="http://youtu.be/WZfNS-pbFYQ" target="_blank">RC controlled cars</a>, etc.</p>
</div>
<div class="paragraph">
<p>One of the popular micro-controllers in use today is the ATmega AVR from Atmel.
This micro-controller is also used in the popular Arduino platfrom.</p>
</div>
<div class="paragraph">
<p>The popularity of the ATmega AVR is due to the availability of free and
inexpensive development tools accelerated by the high number of development
boards available.</p>
</div>
<div class="paragraph">
<p>The  ATmega AVR was the first micro-controller to have an on board flash for
program storage. Compared to the other micro-controllers at the time which
offered one time programmable ROM, EPROM and EEPROM options. The flash offers
reduced cost of development as the frequency with which applications can
be deployed and tested easily increases.</p>
</div>
<div class="paragraph">
<p>The Arduino platform is an open source hardware and software project meant
for hobbyists, designers and artists. The hardware uses a ATmega AVR and
the software consists of an easy to use JAVA like programming IDE based
on Wiring.</p>
</div>
<div class="paragraph">
<p>I&#8217;ve got my hands on an AVR development board called the Device Driver Kit.
The kit can be used to learn about Linux device drivers or can be used as a
ATmega AVR development board for your electronics project.</p>
</div>
<div class="exampleblock">
<div class="content">
<div id="lddk_connected" class="imageblock" style="text-align: center">
<div class="content">
<a class="image" href="../../../../../images/lddk_connected.jpg"><img src="http://zeuzoix.github.io/techeuphoria/images/lddk_connected.jpg" alt="lddk connected" width="640" height="480"></a>
</div>
<div class="title">Figure 1. LDDK board</div>
</div>
</div>
</div>
<div class="paragraph">
<p>The board has a USB interface through which you can program the ATmega
and develop your own applications. This makes it easy to do rapid prototyping
with just a PC and the board. I&#8217;ll be posting some of my side projects which
will use the board.</p>
</div>
<div class="paragraph">
<p>It shouldn&#8217;t be too difficult to whip up a ATmega AVR development board or
a Arduino board with the resources available online. However as a starting
point it would be good to familiarize yourself with the AVR before you
jump into building your own board.</p>
</div>
<div class="paragraph">
<p>Details of the DDK board are available at:<br>
<a href="http://esrijan.com/index.php?pagefile=lddk">http://esrijan.com/index.php?pagefile=lddk</a></p>
</div>
</div>
<footer class="post-footer">
<div class="tags"><i class="label icon-tags"></i>
<a href="/techeuphoria/posts/tag/electronics/">electronics</a>
, <a href="/techeuphoria/posts/tag/productization/">productization</a></div>
</footer>
<hr>
</article>

<article class="post">
<header class="post-head">
<h1 class="title">
<a href="/techeuphoria/posts/2013/05/12/an-introduction-to-i2c/">An Introduction To I2C</a>
</h1>
<h4>
<em>by</em>
<a class="author" href="http://in.linkedin.com/in/conradsjgomes">
Conrad Gomes
</a>
on
<time class="pubdate" datetime="2013-05-12T00:00:00+00:00">
May 12, 2013
</time>
</h4>
</header>
<div class="post-body">
<div class="paragraph">
<p>I2C is a serial data bus used to interface low speed peripherals developed by Phillips. Data sheets of other semi-conductor companies refer to their I2C
like interface as the Two Wire Interface.</p>
</div>
<div class="paragraph">
<p>I2C has two lines SDA and SCL. SDA is used for data input or output on the I2C
interface. SCL is the clock interface and is used to synchronize the data
communication on the SDA line.The device initiating and terminating the
transmission is called the master. The master controls the SCL clock signal.</p>
</div>
<div class="paragraph">
<p>There is only one master active during data communication on the bus however
it does not mean the bus has to have only one master. The I2C protocol can
support multiple masters and multiple slaves. In fact multiple masters can
co-exist if they support an arbitration mechanism.</p>
</div>
<div class="paragraph">
<p>Typically when a master initiates a transfer it will also sense the line in
order to detect if another master is transmitting at the same time. The
arbitration mechanism will force one master to hold back on the transmission.
The master can wait and try again once the line is free or immediately switch
to slave mode if the application requires the device to act in both master
and slave modes</p>
</div>
<div class="paragraph">
<p>More information at :<br></p>
</div>
<div class="olist arabic">
<ol class="arabic">
<li>
<p><a href="http://en.wikipedia.org/wiki/I2C" target="_blank">http://en.wikipedia.org/wiki/I2C</a></p>
</li>
<li>
<p><a href="http://www.esacademy.com/en/library/technical-articles-and-documents/miscellaneous/i2c-bus.html" target="_blank">http://www.esacademy.com/en/library/technical-articles-and-documents/miscellaneous/i2c-bus.html</a></p>
</li>
</ol>
</div>
<div class="exampleblock">
<div class="content">
<div id="I2C" class="imageblock" style="text-align: center">
<div class="content">
<a class="image" href="../../../../../images/I2C.svg"><img src="http://zeuzoix.github.io/techeuphoria/images/I2C.svg" alt="I2C" width="640" height="480"></a>
</div>
<div class="title">Figure 1. Diagram showing an I2C configuration</div>
</div>
</div>
</div>
</div>
<footer class="post-footer">
<div class="tags"><i class="label icon-tags"></i>
<a href="/techeuphoria/posts/tag/electronics/">electronics</a>
, <a href="/techeuphoria/posts/tag/protocols/">protocols</a>
, <a href="/techeuphoria/posts/tag/i2c/">i2c</a>
, <a href="/techeuphoria/posts/tag/twi/">twi</a>
, <a href="/techeuphoria/posts/tag/bus/">bus</a></div>
</footer>
<hr>
</article>

<article class="post">
<header class="post-head">
<h1 class="title">
<a href="/techeuphoria/posts/2013/02/03/kernel-module-makefiles/">Kernel Module Makefiles</a>
</h1>
<h4>
<em>by</em>
<a class="author" href="http://in.linkedin.com/in/conradsjgomes">
Conrad Gomes
</a>
on
<time class="pubdate" datetime="2013-02-03T00:00:00+00:00">
February  3, 2013
</time>
</h4>
</header>
<div class="post-body">
<div class="paragraph">
<p>You&#8217;ve got your kernel module code ready and you want to build it. The following is a simple kernel module makefile which will help you
do this:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="makefile"><table class="CodeRay"><tr>
  <td class="line-numbers"><pre>1
2
3
4
5
6
7
</pre></td>
  <td class="code"><pre>obj-m += hello-1.o

all:
        make -C /lib/modules/$(shell uname -r)/build M=$(PWD) modules <i class="conum" data-value="1"></i><b>(1)</b>

clean:
        make -C /lib/modules/$(shell uname -r)/build M=$(PWD) clean <i class="conum" data-value="2"></i><b>(2)</b></pre></td>
</tr></table></code></pre>
</div>
</div>
<div class="colist arabic">
<table>
<tr>
<td><i class="conum" data-value="1"></i><b>1</b></td>
<td>modules is the target to build the kernel module</td>
</tr>
<tr>
<td><i class="conum" data-value="2"></i><b>2</b></td>
<td>clean is the target to clean the kernel module</td>
</tr>
</table>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
The above makefile will fail if used directly please replace the spaces
at lines 4 and 7 with TABS or please download the following from here
<a href="https://docs.google.com/file/d/0B2qMThwa-F02dlBiaTl1dktTUWc/edit?usp=sharing" target="_blank">makefile1</a>.
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>In this explanation there are two makefiles which I will be referring to.
The first is the one shown above and the second is the main kernel makefile
which is located in the kernel source directory.</p>
</div>
<div class="paragraph">
<p>When you compile the kernel the make process assembles a list of kernel
drirvers and modules that are to be compiled as loadable kernel modules
defined by obj-m.</p>
</div>
<div class="paragraph">
<p>In our example above we indicate that we want to create a kernel module out
of the hello-1.o object file which is eventually built from our hello-1.c
source code.</p>
</div>
<div class="paragraph">
<p>There are two targets for the makefile i.e. all and clean. They invoke the
<em>'modules'</em> and <em>'clean'</em> targets of the main kernel makefile.</p>
</div>
<div class="paragraph">
<p>Let&#8217;s understand the option switches.</p>
</div>
<div class="paragraph">
<p>The <em>-C</em> option switches the make command to the kernel source directory.
Basically this is the directory of the source code used to build the kernel
image with the main kernel makefile. Here <em>$(shell uname -r)</em> is a convenient
way of specifying the name of the live kernel being run when the make
command is executed.</p>
</div>
<div class="paragraph">
<p>The <em>M</em> option tells the main kernel makefile to go to the present working
directory and read the makefile present there. This is a way of telling
the main kernel makefile to read the the makefile shown above. This enables
the main kernel makefile to add the <em>hello-1.o</em> object to its list of modules
to be built.</p>
</div>
<div class="paragraph">
<p>Here <em>$(PWD)</em> is a convenient way of specifying the present working directory.</p>
</div>
<div class="paragraph">
<p>More information is available at:<br>
<a href="http://www.tldp.org/LDP/lkmpg/2.6/html/x181.html" target="_blank">http://www.tldp.org/LDP/lkmpg/2.6/html/x181.html</a></p>
</div>
</div>
<footer class="post-footer">
<div class="tags"><i class="label icon-tags"></i>
<a href="/techeuphoria/posts/tag/kernel/">kernel</a>
, <a href="/techeuphoria/posts/tag/linux/">linux</a>
, <a href="/techeuphoria/posts/tag/programming/">programming</a></div>
</footer>
<hr>
</article>

<div class="pagination-centered">
<ul class="pagination">
<li class="arrow">
<a href="/techeuphoria/blog/">
<i class="icon-step-backward"></i>
</a>
</li>
<li>2 of 3</li>
<li class="arrow">
<a href="/techeuphoria/posts/page/3/">
<i class="icon-step-forward"></i>
</a>
</li>
</ul>
</div>

</div>
</div>

</div>
</div>
<footer class="row" style="max-width: 100%">
<hr>
<div class="large-6 columns">
<p style="margin-bottom: .75em">
&copy; conrad.s.j.gomes@gmail.com 2015
<br>
Built on Foundation. Baked by Awestruct. Composed with Asciidoc
</p>
</div>
<div class="large-6 columns">
<ul class="inline-list right">
<li>
<a href="http://zeuzoix.github.io/techeuphoria/">Home</a>
</li>
</ul>
</div>
</footer>
<script>
document.write('<script src=' + ('__proto__' in {} ? 'http://zeuzoix.github.io/techeuphoria/javascripts/vendor/zepto' : 'http://zeuzoix.github.io/techeuphoria/javascripts/vendor/jquery') + '.js><\/script>')
</script>
<script src="http://zeuzoix.github.io/techeuphoria/javascripts/foundation/foundation.js"></script>
<script src="http://zeuzoix.github.io/techeuphoria/javascripts/foundation/foundation.topbar.js"></script>
<script>
$(document).foundation()
</script>
</body>
</html>
