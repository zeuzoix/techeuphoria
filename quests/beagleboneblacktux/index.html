<!DOCTYPE html>
<!--[if IE 8]><html class="no-js lt-ie9" lang="en"><![endif]-->
<!--[if gt IE 8]><!--><html class="no-js" lang="en"><!--<![endif]-->
<head>
<meta charset="utf-8">
<meta content="width=device-width, initial-scale=1.0" name="viewport">
<title>A Technical Odyssey</title>
<link href="http://zeuzoix.github.io/techeuphoria/stylesheets/app.css" rel="stylesheet">
<link href="/techeuphoria/feed.xml" rel="alternate" type="application/atom+xml">
<script src="http://zeuzoix.github.io/techeuphoria/javascripts/vendor/custom.modernizr.js"></script>
<link href="http://zeuzoix.github.io/techeuphoria/humans.txt" rel="author" type="text/plain">
</head>
<body class="antialiased">
<div class="fixed-width">
<nav class="top-bar">
<ul class="title-area">
<li class="name">
<h1>
<a href="/techeuphoria/">
TechEuphoria
</a>
</h1>
</li>
<li class="toggle-topbar menu-icon">
<a href="#"><span></span></a>
</li>
</ul>
<section class="top-bar-section">
<ul class="left">
<li class="divider">
<li>
<a href="/techeuphoria/quests/index.html">/quests</a>
</li>
</li>
<li class="divider"></li>
</ul>
</section>
</nav>
</div>
<div class="row">
<div class="large-12 columns">
<h1></h1>
</div>
</div>
<div class="row" id="content">
<div class="large-12 columns">
<div id="preamble">
<div class="sectionbody">
<div id="toc" class="toc">
<div id="toctitle" class="title">Table of Contents</div>
<ul class="sectlevel0">
<li><a href="#introduction">Introduction</a>
<ul class="sectlevel1">
<li><a href="#about-the-linux-kernel">1. About The Linux Kernel</a></li>
<li><a href="#about-beagleboard">2. About BeagleBoard</a></li>
<li><a href="#about-free-electrons">3. About Free Electrons</a></li>
</ul>
</li>
<li><a href="#training-and-workbench-setup">Training and Workbench Setup</a>
<ul class="sectlevel1">
<li><a href="#hardware">4. Hardware</a>
<ul class="sectlevel2">
<li><a href="#beaglebone-black">4.1. BeagleBone Black</a></li>
</ul>
</li>
<li><a href="#software">5. Software</a>
<ul class="sectlevel2">
<li><a href="#ubuntu">5.1. Ubuntu</a></li>
<li><a href="#git">5.2. GIT</a></li>
<li><a href="#free-electrons">5.3. Free Electrons</a></li>
</ul>
</li>
</ul>
</li>
<li><a href="#the-kernel-source-code">The Kernel Source Code</a>
<ul class="sectlevel1">
<li><a href="#offical-and-unofficial-kernel-sources">6. Offical and Unofficial Kernel Sources</a>
<ul class="sectlevel2">
<li><a href="#cloning-the-linux-tree-with-git">6.1. Cloning the Linux Tree With GIT</a></li>
<li><a href="#using-stable-releases">6.2. Using Stable Releases</a></li>
</ul>
</li>
<li><a href="#why-are-the-sources-so-big">7. Why Are The Sources So Big?</a>
<ul class="sectlevel2">
<li><a href="#size-comparison-of-different-kernel-source-directories">7.1. Size Comparison of Different Kernel Source Directories</a></li>
</ul>
</li>
<li><a href="#programming-religion">8. Programming Religion</a></li>
<li><a href="#no-c-library">9. No C Library</a></li>
<li><a href="#portability">10. Portability</a></li>
<li><a href="#linux-internal-api">11. Linux Internal API</a></li>
<li><a href="#is-it-free">12. Is It Free?</a></li>
<li><a href="#advantages-of-gpl-drivers">13. Advantages Of GPL Drivers</a></li>
<li><a href="#advantages-of-in-tree-kernel-drivers">14. Advantages Of In-Tree Kernel Drivers</a></li>
<li><a href="#user-space-device-drivers">15. User Space Device Drivers</a>
<ul class="sectlevel2">
<li><a href="#examples-of-user-space-device-drivers">15.1. Examples Of User Space Device Drivers</a></li>
<li><a href="#the-good-and-the-bad-of-user-space-device-drivers">15.2. The Good And The Bad Of User Space Device Drivers</a></li>
</ul>
</li>
<li><a href="#what-s-in-the-sources">16. What&#8217;s In The Sources?</a></li>
<li><a href="#browsing-the-sources">17. Browsing The Sources</a>
<ul class="sectlevel2">
<li><a href="#cscope">17.1. Cscope</a></li>
<li><a href="#lxr">17.2. LXR</a></li>
</ul>
</li>
<li><a href="#lab-1-getting-accustomed-to-browsing-the-sources">18. LAB 1 : Getting Accustomed To Browsing The Sources</a>
<ul class="sectlevel2">
<li><a href="#creating-a-branch-to-a-particular-stable-kernel-version">18.1. Creating A Branch To A Particular Stable Kernel Version</a></li>
<li><a href="#searching-tools">18.2. Searching Tools</a>
<ul class="sectlevel3">
<li><a href="#using-find">18.2.1. Using Find</a></li>
<li><a href="#using-git-grep">18.2.2. Using Git-Grep</a></li>
<li><a href="#using-linux-cross-reference">18.2.3. Using Linux Cross Reference</a></li>
</ul>
</li>
</ul>
</li>
<li><a href="#configuring-the-kernel">19. Configuring The Kernel</a>
<ul class="sectlevel2">
<li><a href="#kernel-configuration">19.1. Kernel Configuration</a>
<ul class="sectlevel3">
<li><a href="#kernel-configuration-in-the-system">19.1.1. Kernel Configuration In The System</a></li>
</ul>
</li>
<li><a href="#configuring-features-as-modules">19.2. Configuring Features As Modules</a></li>
<li><a href="#kernel-option-types">19.3. Kernel Option Types</a></li>
<li><a href="#kernel-option-dependencies">19.4. Kernel Option Dependencies</a></li>
<li><a href="#graphical-configuration-interface-em-xconfig-em">19.5. Graphical Configuration Interface <em>xconfig</em></a></li>
<li><a href="#graphical-configuration-interface-em-gconfig-em">19.6. Graphical Configuration Interface <em>gconfig</em></a></li>
<li><a href="#text-configuration-interface-em-menuconfig-em">19.7. Text Configuration Interface <em>menuconfig</em></a></li>
<li><a href="#text-configuration-interface-em-nconfig-em">19.8. Text Configuration Interface <em>nconfig</em></a></li>
<li><a href="#make-oldconfig">19.9. make oldconfig</a></li>
<li><a href="#reverting-to-a-previous-configuration">19.10. Reverting To A Previous Configuration</a></li>
</ul>
</li>
<li><a href="#compiling-the-kernel">20. Compiling The Kernel</a></li>
<li><a href="#kernel-installation">21. Kernel Installation</a>
<ul class="sectlevel2">
<li><a href="#kernel-module-installation">21.1. Kernel Module Installation</a></li>
<li><a href="#cleaning-up">21.2. Cleaning Up</a></li>
</ul>
</li>
<li><a href="#cross-compiling-the-kernel">22. Cross-Compiling The Kernel</a>
<ul class="sectlevel2">
<li><a href="#predefined-configuration-files">22.1. Predefined Configuration Files</a></li>
<li><a href="#saving-our-default-configuration">22.2. Saving Our Default Configuration</a></li>
<li><a href="#device-tree">22.3. Device Tree</a></li>
<li><a href="#steps-to-build-and-install-a-kernel">22.4. Steps To Build and Install A Kernel</a></li>
<li><a href="#using-u-boot">22.5. Using U-Boot</a></li>
<li><a href="#kernel-command-line">22.6. Kernel Command Line</a></li>
</ul>
</li>
<li><a href="#lab-2-setting-up-the-beaglebone-black-board">23. LAB 2 : Setting Up The Beaglebone Black Board</a>
<ul class="sectlevel2">
<li><a href="#getting-comfortable-with-the-board">23.1. Getting Comfortable With The Board</a>
<ul class="sectlevel3">
<li><a href="#connectors-leds-and-switches">23.1.1. Connectors, LEDs and Switches</a></li>
<li><a href="#system-key-components">23.1.2. System Key Components</a></li>
</ul>
</li>
<li><a href="#downloading-the-technical-documentation">23.2. Downloading The Technical Documentation</a></li>
<li><a href="#installing-the-free-electrons-lab-data">23.3. Installing The Free Electrons Lab Data</a></li>
<li><a href="#making-a-bootable-microsd-card">23.4. Making A Bootable MicroSD Card</a></li>
</ul>
</li>
</ul>
</li>
</ul>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
<div class="title">This document is under active development!</div>
<div class="paragraph">
<p>If you find errors or omissions in this document, please don&#8217;t hesitate to <a href="mailto:conrad.s.j.gomes@gmail.com">send me a mail</a>.</p>
</div>
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>This journal assumes you are comfortable with a linux environment as most of the
published work here uses an Ubuntu distribution as the work station.</p>
</div>
</div>
</div>
<h1 id="introduction" class="sect0"><a class="anchor" href="#introduction"></a>Introduction</h1>
<div class="openblock partintro">
<div class="content">
<div class="paragraph">
<p>This journal was started in order to document my exploration of embedded linux
using a popular low-cost platform i.e. the BeagleBone Black. The end objective
is to become well versed with embedded linux development on an ARM based embedded
device.</p>
</div>
</div>
</div>
<div class="sect1">
<h2 id="about-the-linux-kernel"><a class="anchor" href="#about-the-linux-kernel"></a>1. About The Linux Kernel</h2>
<div class="sectionbody">
<div class="quoteblock">
<blockquote>
I&#8217;m doing a (free) operating system (just a hobby, won&#8217;t be big and
professional like gnu) for 386(486) AT clones. This has been brewing
since April and is starting to get ready. I&#8217;d like any feedback on things
people like/dislike in minix, as my OS resembles it somewhat (same physical
layout of the file-system (due to practical reasons) among other things).
</blockquote>
<div class="attribution">
&#8212; Linus Torvald: 25th August 1991
</div>
</div>
<div class="paragraph">
<p>The Linux kernel started off as a hobby project and by a Finnish
national Linus Torvalds. It is today the OS powering the largest number of
computers on the planet. It is used in phones, tablets, laptops, netbooks,
routers, desktops, servers, supercomputers, embedded devices, consumer
electronics, etc.</p>
</div>
<div class="paragraph">
<p>The development of the Linux kernel is carried out by an army of dynamic
open source developers, the majority of which comprise of hobbyists.
Significant contribution to the kernel is now coming from companies using
the kernel. The development is still spearheaded by Linus who is employed
by the <a href="http://www.linuxfoundation.org/" target="_blank">Linux Foundation</a>.</p>
</div>
</div>
</div>
<div class="sect1">
<h2 id="about-beagleboard"><a class="anchor" href="#about-beagleboard"></a>2. About BeagleBoard</h2>
<div class="sectionbody">
<div class="paragraph">
<p><a href="http://beagleboard.org/" target="_blank">BeagleBoard.org Foundation</a> is a non-profit corporation which
promotes open source software and open hardware. It was started by enthusiasts
from TI with the aim of providing a powerful platform to design embedded solutions.
The BeagleBone Black is their fourth board till date which offers a lot of
possibilities in a small credit card size form factor.</p>
</div>
</div>
</div>
<div class="sect1">
<h2 id="about-free-electrons"><a class="anchor" href="#about-free-electrons"></a>3. About Free Electrons</h2>
<div class="sectionbody">
<div class="paragraph">
<p><a href="http://free-electrons.com/" target="_blank">Free Electrons</a> is an engineering company consisting of
embedded linux experts who support companies using Embedded Linux. They
additionally conduct training workshops for companies on different topics
such as Linux kernel and device driver development, Android system development,
Yocto Project and OpenEmbedded development, etc. This journal uses the Free
Electrons training material which they publish online to explore Embedded Linux
with the BeagleBone Black board from TI.</p>
</div>
</div>
</div>
<h1 id="training-and-workbench-setup" class="sect0"><a class="anchor" href="#training-and-workbench-setup"></a>Training and Workbench Setup</h1>
<div class="openblock partintro">
<div class="content">
<div class="paragraph">
<p>This section covers the setup software and hardware used in this journal.
The sources of the training material and references are mentioned as well
as details about how to procure the hardware.</p>
</div>
</div>
</div>
<div class="sect1">
<h2 id="hardware"><a class="anchor" href="#hardware"></a>4. Hardware</h2>
<div class="sectionbody">
<div class="sect2">
<h3 id="beaglebone-black"><a class="anchor" href="#beaglebone-black"></a>4.1. BeagleBone Black</h3>
<div class="paragraph">
<p>The BeagleBone Black is the newest member in the BeagleBoard family. The board
is designed to be a low sized small form factor board. The size of the board
is comparable to the size of a credit card and it offers expansion headers to
add headers called as capes similar to the <a href="http://www.raspberrypi.org/" target="_blank">Raspberry Pi</a>.</p>
</div>
<div class="exampleblock">
<div class="content">
<div id="beagleboneblacktux-BeagleBoneBlackREV_A5A" class="imageblock" style="text-align: center">
<div class="content">
<a class="image" href="images/BeagleBoneBlackREV_A5A.jpg"><img src="http://zeuzoix.github.io/techeuphoria/images/BeagleBoneBlackREV_A5A.jpg" alt="BeagleBoneBlackREV A5A" width="640" height="480"></a>
</div>
<div class="title">Beagle Bone Black Revision A5A Board</div>
</div>
</div>
</div>
<div class="paragraph">
<p>The table below highlights the key onboard components of the board along with
the connectors available on the board. The diagram of the table below is taken
from the <a href="docs/BBB_SRM.pdf" target="_blank">BeagleBone Black System Reference Manual</a>.</p>
</div>
<div class="exampleblock">
<div class="content">
<div id="beagleboneblacktux-BeagleBoneBlackFeatures" class="imageblock" style="text-align: center">
<div class="content">
<a class="image" href="images/BeagleBoneBlackFeatures.jpg"><img src="http://zeuzoix.github.io/techeuphoria/images/BeagleBoneBlackFeatures.jpg" alt="BeagleBoneBlackFeatures" width="640" height="480"></a>
</div>
<div class="title">Beagle Bone Black Feature Table</div>
</div>
</div>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="software"><a class="anchor" href="#software"></a>5. Software</h2>
<div class="sectionbody">
<div class="sect2">
<h3 id="ubuntu"><a class="anchor" href="#ubuntu"></a>5.1. Ubuntu</h3>
<div class="paragraph">
<p>To work with an embedded system you need a work station on which you can
perform the various tasks that are required in the development life cycle.
These tasks include:</p>
</div>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>Editing your build scripts and source code</p>
</li>
<li>
<p>Cross-compiling your source code for the embedded target</p>
</li>
<li>
<p>Transferring or accessing the cross-compiled application and libraries
to or from the embedded target</p>
</li>
<li>
<p>Collecting debug information from the target</p>
</li>
<li>
<p>Communicating with the target remotely using its interfaces like
serial, USB, network, etc..</p>
</li>
</ol>
</div>
<div class="paragraph">
<p>In this document we use the popular Debian based Linux operating system,
<a href="http://www.ubuntu.com/">Ubuntu</a> as our work station for all the tasks listed above.
Ubuntu can be easily downloaded and installed on any PC or laptop.</p>
</div>
<div class="admonitionblock important">
<table>
<tr>
<td class="icon">
<i class="fa icon-important" title="Important"></i>
</td>
<td class="content">
<div class="title">Do not use a virtual machine runnning Ubuntu as your workstation</div>
<div class="paragraph">
<p>This document uses Ubuntu 14.04 running on a HP laptop. Use of a similar
environment through a virtual machine runnning on <a href="http://www.vmware.com" target="_blank">VMWare</a> or
<a href="https://www.virtualbox.org/" target="_blank">Oracle VirtualBox</a> is
not recommended.</p>
</div>
</td>
</tr>
</table>
</div>
</div>
<div class="sect2">
<h3 id="git"><a class="anchor" href="#git"></a>5.2. GIT</h3>
<div class="paragraph">
<p>The source code management tool used by the Linux kernel community is
<a href="http://git-scm.com/" target="_blank">GIT</a>. To use GIT we need to install the packages required
on our work station using the Advanced Packaging Tool(APT) using a
command line terminal.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="bash">conrad@conrad-HP-Pavilion-dm3-Notebook-PC:~$ sudo apt-get install git gitk git-email</code></pre>
</div>
</div>
<div class="paragraph">
<p>Once the packages are successfully installed we will need to configure GIT with
some basic information about our name and email address</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="bash">conrad@conrad-HP-Pavilion-dm3-Notebook-PC:~$ git config --global user.name Conrad Gomes
conrad@conrad-HP-Pavilion-dm3-Notebook-PC:~$ git config --global user.email conrad.s.j.gomes@gmail.com</code></pre>
</div>
</div>
<div class="paragraph">
<p>Further infomation about GIT can be obtained at:<br>
<a href="http://git-scm.com/" target="_blank">http://git-scm.com/</a>.</p>
</div>
</div>
<div class="sect2">
<h3 id="free-electrons"><a class="anchor" href="#free-electrons"></a>5.3. Free Electrons</h3>
<div class="paragraph">
<p>Since we are going through the training material provided by Free Electrons
we&#8217;ll need to download their slides and lab data from their website link:<br>
<a href="http://free-electrons.com/training/kernel/" target="_blank">http://free-electrons.com/training/kernel/</a></p>
</div>
<div class="paragraph">
<p>As Free Electrons continues to improve on their training material, this journal
will be based on the version available at the time of its writing:</p>
</div>
<div class="olist arabic">
<ol class="arabic">
<li>
<p><a href="free_electrons_linux_kernel/linux-kernel-slides.pdf" target="_blank">Slides</a></p>
</li>
<li>
<p><a href="free_electrons_linux_kernel/linux-kernel-labs.pdf" target="_blank">Labs</a></p>
</li>
<li>
<p><a href="free_electrons_linux_kernel/linux-kernel-labs.tar.xz" target="_blank">Lab Data</a></p>
</li>
</ol>
</div>
</div>
</div>
</div>
<h1 id="the-kernel-source-code" class="sect0"><a class="anchor" href="#the-kernel-source-code"></a>The Kernel Source Code</h1>
<div class="openblock partintro">
<div class="content">
<div class="paragraph">
<p>This section covers details about the Linux Kernel source code. We will go through
the source code, its structure and characteristics.</p>
</div>
</div>
</div>
<div class="sect1">
<h2 id="offical-and-unofficial-kernel-sources"><a class="anchor" href="#offical-and-unofficial-kernel-sources"></a>6. Offical and Unofficial Kernel Sources</h2>
<div class="sectionbody">
<div class="paragraph">
<p>The official source of the Linux Kernel is available at:<br>
<a href="https://www.kernel.org/" target="_blank">https://www.kernel.org/</a></p>
</div>
<div class="paragraph">
<p>The sources present in this website do not represent the entire spectrum of
features and development that is taking place. Since the kernel is logically
divided into sub-systems, each sub-system is maintained by a designated
individual who has been involved with the sub-system and is trusted by Linus.
So when the merge window opens these individuals who are termed as "maintainers"
send pull requests to Linus to take in the patches from their repositories for
merging with the mainline kernel tree. In some cases if the subsystem is large
it may be divided into smaller subsystems which are managed by individuals
designated as "sub-maintainers".</p>
</div>
<div class="paragraph">
<p>The official development repository for some sub-systems are given below:</p>
</div>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>MTD<br>
<strong>Website:</strong> <a href="http://www.linux-mtd.infradead.org/index.html" target="_blank">http://www.linux-mtd.infradead.org/index.html</a><br>
<strong>GIT:</strong> git://git.infradead.org/linux-mtd.git</p>
</li>
<li>
<p>MIPS<br>
<strong>Website:</strong> <a href="http://www.linux-mips.org/wiki/Main_Page" target="_blank">http://www.linux-mips.org/wiki/Main_Page</a><br>
<strong>GIT:</strong> git://git.linux-mips.org/pub/scm/ralf/linux.git</p>
</li>
<li>
<p>USB<br>
<strong>Website:</strong> <a href="http://www.linux-usb.org/" target="_blank">http://www.linux-usb.org/</a><br>
<strong>GIT:</strong> git://git.kernel.org/pub/scm/linux/kernel/git/gregkh/patches.git</p>
</li>
</ol>
</div>
<div class="sect2">
<h3 id="cloning-the-linux-tree-with-git"><a class="anchor" href="#cloning-the-linux-tree-with-git"></a>6.1. Cloning the Linux Tree With GIT</h3>
<div class="paragraph">
<p>Now that GIT is present in the workstation we can get the main development tree
of the Linux kernel as follows:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="bash">conrad@conrad-HP-Pavilion-dm3-Notebook-PC:~$ git clone git://git.kernel.org/pub/scm/linux/kernel/git/torvalds/linux.git</code></pre>
</div>
</div>
<div class="paragraph">
<p>And if you&#8217;re in a corporarte environment or if your firewall blocks out the
network port for <em>git</em> you can use <em>http</em> instead as follows:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="bash">conrad@conrad-HP-Pavilion-dm3-Notebook-PC:~$ git clone http://git.kernel.org/pub/scm/linux/kernel/git/torvalds/linux.git</code></pre>
</div>
</div>
<div class="paragraph">
<p>The whole process should take a while so you can go for a small coffee break
and come back. Comparitively using <em>git</em> is recommended as it is faster than
<em>http</em></p>
</div>
<div class="paragraph">
<p>If you happen to have a copy of the Linux GIT repository all you have to do
is pull in the latest changes</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="bash">conrad@conrad-HP-Pavilion-dm3-Notebook-PC:~$ cd ~/git/linux
conrad@conrad-HP-Pavilion-dm3-Notebook-PC:~/git/linux$ git checkout master
conrad@conrad-HP-Pavilion-dm3-Notebook-PC:~/git/linux$ git pull</code></pre>
</div>
</div>
<div class="paragraph">
<p>Once you have the Linux GIT repository you can pull the latest changes by
by running <em>git pull</em>.</p>
</div>
</div>
<div class="sect2">
<h3 id="using-stable-releases"><a class="anchor" href="#using-stable-releases"></a>6.2. Using Stable Releases</h3>
<div class="paragraph">
<p>Typically when we are developing a project we reuse multiple projects to build
our application on top of. Similarly since we will be learing about Embedded
Linux we cannot use the tip of the tree as it is the latest but not the stablest
version of the kernel.</p>
</div>
<div class="paragraph">
<p>With GIT we don&#8217;t have to clone the whole repository all over again. Instead we
can add a reference to a remote tree to our existing clone and fetch all the
commits which are unique in that repository. As the <strong><em>stable</em></strong> release is
derived from the <strong><em>mainline</em></strong> tree we can add a remote to our repository as
follows:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="bash">conrad@conrad-HP-Pavilion-dm3-Notebook-PC:~/git/linux$ git remote -v <i class="conum" data-value="1"></i><b>(1)</b>
origin        git://git.kernel.org/pub/scm/linux/kernel/git/torvalds/linux.git (fetch)
origin        git://git.kernel.org/pub/scm/linux/kernel/git/torvalds/linux.git (push)
conrad@conrad-HP-Pavilion-dm3-Notebook-PC:~/git/linux$ git remote add stable git://git.kernel.org/pub/scm/linux/kernel/git/stable/linux-stable.git <i class="conum" data-value="2"></i><b>(2)</b>
conrad@conrad-HP-Pavilion-dm3-Notebook-PC:~/git/linux$ git remote -v
origin        git://git.kernel.org/pub/scm/linux/kernel/git/torvalds/linux.git (fetch)
origin        git://git.kernel.org/pub/scm/linux/kernel/git/torvalds/linux.git (push)
stable        git://git.kernel.org/pub/scm/linux/kernel/git/stable/linux-stable.git (fetch) <i class="conum" data-value="3"></i><b>(3)</b>
stable        git://git.kernel.org/pub/scm/linux/kernel/git/stable/linux-stable.git (push)</code></pre>
</div>
</div>
<div class="colist arabic">
<table>
<tr>
<td><i class="conum" data-value="1"></i><b>1</b></td>
<td><em>git remote -v</em> lists the remotes. By default the git repository from which the repository was cloned will be the main remote</td>
</tr>
<tr>
<td><i class="conum" data-value="2"></i><b>2</b></td>
<td><em>git remote add</em> adds a new remote with the name stable</td>
</tr>
<tr>
<td><i class="conum" data-value="3"></i><b>3</b></td>
<td><em>git remote -v</em> lists the new added remote</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>The last part is fetching the unique commits in the <strong><em>stable</em></strong> remote. This
command should take a while.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="bash">conrad@conrad-HP-Pavilion-dm3-Notebook-PC:~/git/linux$ git fetch stable</code></pre>
</div>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="why-are-the-sources-so-big"><a class="anchor" href="#why-are-the-sources-so-big"></a>7. Why Are The Sources So Big?</h2>
<div class="sectionbody">
<div class="paragraph">
<p>One of the reasons why cloning the kernel sources takes so long is that the
Linux Kernel source code is BIG. This is because the Kernel source code
contains many subsystems, frameworks, drivers, network protocols and supports
many different processor architectures.</p>
</div>
<div class="sect2">
<h3 id="size-comparison-of-different-kernel-source-directories"><a class="anchor" href="#size-comparison-of-different-kernel-source-directories"></a>7.1. Size Comparison of Different Kernel Source Directories</h3>
<div class="paragraph">
<p>If we check the disk usage per directory in the Linux Kernel source code we
get the distribution below. We&#8217;ll go through the type of source code in each
of those directories in a later section.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="bash">conrad@conrad-HP-Pavilion-dm3-Notebook-PC:~/git/linux$ du -s ./*/ | sort -nr
3084600        ./drivers/
723496        ./net/
589520        ./fs/
275636        ./arch/
260960        ./sound/
84020        ./kernel/
52264        ./security/
38628        ./include/
36340        ./crypto/
28968        ./Documentation/
27616        ./lib/
25984        ./mm/
17768        ./block/
8920        ./firmware/
8440        ./tools/
4356        ./scripts/
3760        ./ipc/
3720        ./init/
2596        ./virt/
248        ./samples/
92        ./usr/</code></pre>
</div>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="programming-religion"><a class="anchor" href="#programming-religion"></a>8. Programming Religion</h2>
<div class="sectionbody">
<div class="paragraph">
<p>The Linux Kernel is written primarily in C with a little assembly code too. The
source code is written in a version of C supported by Gnu Compiler Collection
or GCC. Therefore the Linux Kernel source can not be compiled with all C
compilers.</p>
</div>
<div class="paragraph">
<p>The assembly code comprises of small sections of code and is basically the
GCC&#8217;s "AT&amp;T-style" syntax of target architecture which will run the kernel.</p>
</div>
<div class="paragraph">
<p>Even though the Linux Kernel has certain frameworks designed with Object
Oriented Principles in mind it is not written in C. For further
understanding on why C is still not used please see the following link:
<a href="http://www.tux.org/lkml/#s15-3" target="_blank">http://www.tux.org/lkml/#s15-3</a></p>
</div>
<div class="paragraph">
<p>And on a lighter note &#8230;&#8203;</p>
</div>
<div class="quoteblock">
<blockquote>
<div class="paragraph">
<p>In fact, in Linux we did try C++ once already, back in 1992.</p>
</div>
<div class="paragraph">
<p>It sucks. Trust me - writing kernel code in C++ is a BLOODY STUPID IDEA.</p>
</div>
<div class="paragraph">
<p>The fact is, C++ compilers are not trustworthy. They were even worse in
1992, but some fundamental facts haven&#8217;t changed:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>the whole C++ exception handling thing is fundamentally broken. It&#8217;s
<em>especially</em> broken for kernels.</p>
</li>
<li>
<p>any compiler or language that likes to hide things like memory
allocations behind your back just isn&#8217;t a good choice for a kernel.</p>
</li>
<li>
<p>you can write object-oriented code (useful for filesystems etc) in C,
<em>without</em> the crap that is C++.</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>In general, I&#8217;d say that anybody who designs his kernel modules for C is
either
 (a) looking for problems
 (b) a C bigot that can&#8217;t see what he is writing is really just C anyway
 (c) was given an assignment in CS class to do so.</p>
</div>
<div class="paragraph">
<p>Feel free to make up (d).</p>
</div>
</blockquote>
<div class="attribution">
&#8212; Linus Torvalds<br>
<cite>19 Jan 2004</cite>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="no-c-library"><a class="anchor" href="#no-c-library"></a>9. No C Library</h2>
<div class="sectionbody">
<div class="paragraph">
<p>The Linux Kernel is a single program which has its own routines to perform
common functions. It does not use any user space library like stdlib, rather
it has equivalent functions that enable it to achieve the same results.</p>
</div>
<div class="paragraph">
<p>In place of the standard C functions like printf(), memset(), malloc() there
are functions like printk(), memset(),kmalloc() in the source code.</p>
</div>
</div>
</div>
<div class="sect1">
<h2 id="portability"><a class="anchor" href="#portability"></a>10. Portability</h2>
<div class="sectionbody">
<div class="paragraph">
<p>One of the Linux Kernel key features is portability and hardware support.
It supports a wide variety of architectures and to achieve this the source
code should be portable across architectures. The architecture specific code is
all located in the <em>arch/</em> directory. The remaining code in all the other
directories has to be portable across all architectures.</p>
</div>
<div class="paragraph">
<p>To achieve portability there are hardware abstraction API for specific
features:</p>
</div>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>Endianess</p>
<div class="ulist">
<ul>
<li>
<p>cpu_to_be32()</p>
</li>
<li>
<p>cpu_to_le32()</p>
</li>
<li>
<p>be32_to_cpu()</p>
</li>
<li>
<p>le32_to_cpu()</p>
</li>
</ul>
</div>
</li>
<li>
<p>I/O Memory Access</p>
</li>
<li>
<p>Memory barriers</p>
</li>
<li>
<p>DMA API to flush and invalidate caches</p>
</li>
</ol>
</div>
<div class="paragraph">
<p>Since the Linux Kernel is designed to run on any processor the use of floating
point expressions is not allowed. As an example consider the most popular embedded
architecture i.e. ARM, it does not have a floating point unit.</p>
</div>
</div>
</div>
<div class="sect1">
<h2 id="linux-internal-api"><a class="anchor" href="#linux-internal-api"></a>11. Linux Internal API</h2>
<div class="sectionbody">
<div class="paragraph">
<p>One of the main reasons for having drivers in-tree i.e. present along with the
sources of the Linux Kernel is that the internal Linux API may be changed at
any point in time and if a change is proposed and implemented the developer
responsible for the API change will also have to take the ownership of changing
all the modules and drivers which use the changed API. In the case of an
out-of-tree driver the work will be owned by the driver owner and any time a
change occurs the driver will not compile with the latest kernel source code.</p>
</div>
<div class="paragraph">
<p>Having said that the Linux Kernel external API i.e. kernel to userspace API like
system calls, /proc, /sys does not change and is considered to protect the user
space applications who depend on it.</p>
</div>
</div>
</div>
<div class="sect1">
<h2 id="is-it-free"><a class="anchor" href="#is-it-free"></a>12. Is It Free?</h2>
<div class="sectionbody">
<div class="paragraph">
<p>The Linux Kernel is licensed under GNU General Public License version 2. This
license defines the Linux Kernel as Free Software as defined by the
<a href="http://www.fsf.org/" target="_blank">Free Software Foundation</a>.</p>
</div>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>If you redistribute the software you have to do so under the same license
irrespective of whether it is modified or unmodified.</p>
</li>
<li>
<p>If you make modifications to the Linux Kernel you have to release it under
the same license.</p>
</li>
<li>
<p>You only have to do so when your device with the kernel start getting
distributed</p>
</li>
<li>
<p>You only have to license it to your customers and not necessarily the whole
world.</p>
</li>
<li>
<p>It is illegal to distribute a binary kernel with statically compiled
proprietary drivers.</p>
</li>
<li>
<p>Proprietary drivers are frowned upon by the Linux Kernel community as it goes
against the philosophy of the GPL license.</p>
</li>
</ol>
</div>
</div>
</div>
<div class="sect1">
<h2 id="advantages-of-gpl-drivers"><a class="anchor" href="#advantages-of-gpl-drivers"></a>13. Advantages Of GPL Drivers</h2>
<div class="sectionbody">
<div class="olist arabic">
<ol class="arabic">
<li>
<p>It is possible to reuse software from other GPL drivers to write a new GPL
driver</p>
</li>
<li>
<p>A GPL driver has more contributors, testers, reviewers and maintainers
thereby making it more robust.</p>
</li>
<li>
<p>Once the driver is accepted it is easily shipped and distributed by
others who are using the Linux Kernel.</p>
</li>
<li>
<p>A pre-compiled driver will always have to catch up with the latest kernel
devlopments leaving users of the driver at a loss as they can&#8217;t upgrade
their kernel with ease in order to use the latest source with new features</p>
</li>
<li>
<p>Making a driver GPL compliant avoids any potential legal hastles</p>
</li>
</ol>
</div>
</div>
</div>
<div class="sect1">
<h2 id="advantages-of-in-tree-kernel-drivers"><a class="anchor" href="#advantages-of-in-tree-kernel-drivers"></a>14. Advantages Of In-Tree Kernel Drivers</h2>
<div class="sectionbody">
<div class="olist arabic">
<ol class="arabic">
<li>
<p>Acceptance of a driver into the mainline kernel is a step that must be
done by developers who have developed a GPL compatible driver.</p>
</li>
<li>
<p>This allows the developer to release the ownership of maintaining the
kernel driver to the community. This reduces the cost of maintainence.</p>
</li>
<li>
<p>The source of the kernel driver is easily accessible by anyone, as the
kernel code is widely published.</p>
</li>
</ol>
</div>
</div>
</div>
<div class="sect1">
<h2 id="user-space-device-drivers"><a class="anchor" href="#user-space-device-drivers"></a>15. User Space Device Drivers</h2>
<div class="sectionbody">
<div class="paragraph">
<p>It is possible to develop a user space device driver. There are several
scenarios in which a user space device driver is developed:</p>
</div>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>The device driver does not depend on any of the frameworks exposed by
the Linux Kernel.</p>
</li>
<li>
<p>The device driver is used by only one application and is not required
by any other application.</p>
</li>
<li>
<p>The kernel provides a simple interface with which the user space device
driver can control and read the hardware for which it is developed.</p>
</li>
</ol>
</div>
<div class="sect2">
<h3 id="examples-of-user-space-device-drivers"><a class="anchor" href="#examples-of-user-space-device-drivers"></a>15.1. Examples Of User Space Device Drivers</h3>
<div class="paragraph">
<p>Certain busses have interfaces exposed by the kernel which can be used to
develop a user space device driver if the hardware is connected to that
bus:</p>
</div>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>USB with libusb, <a href="http://www.libusb.org/" target="_blank">http://www.libusb.org/</a></p>
</li>
<li>
<p>SPI wiht spidev, <a href="https://www.kernel.org/doc/Documentation/spi/spidev" target="_blank">Documentation/spi/spidev</a></p>
</li>
<li>
<p>I2C with i2cdev, <a href="https://www.kernel.org/doc/Documentation/i2c/dev-interface" target="_blank">Documentation/i2c/dev-interface</a></p>
</li>
<li>
<p>Memory-mapped devices with UIO, including interrupt handling, <a href="http://free-electrons.com/kerneldoc/latest/DocBook/uio-howto/" target="_blank">http://free-electrons.com/kerneldoc/latest/DocBook/uio-howto/</a></p>
</li>
</ol>
</div>
<div class="paragraph">
<p>On certain SOCs the vendor also provides a user space device driver along with
a kernel driver which has access to other processors in the SOC which are
running a firmware for highly specialized applications.</p>
</div>
</div>
<div class="sect2">
<h3 id="the-good-and-the-bad-of-user-space-device-drivers"><a class="anchor" href="#the-good-and-the-bad-of-user-space-device-drivers"></a>15.2. The Good And The Bad Of User Space Device Drivers</h3>
<div class="paragraph">
<p>The Good</p>
</div>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>The driver can be written in any programming language or script.</p>
</li>
<li>
<p>The driver can be kept proprietary.</p>
</li>
<li>
<p>The driver runs in user space as an application or daemon.</p>
</li>
<li>
<p>The driver cannot bring down the kernel.</p>
</li>
</ol>
</div>
<div class="paragraph">
<p>The Bad</p>
</div>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>Handling interrupts from the hardware is non-trivial resulting in some sort
of polling mechanism.</p>
</li>
<li>
<p>The interrupt latency is larger when compared to a kernel device driver.</p>
</li>
</ol>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="what-s-in-the-sources"><a class="anchor" href="#what-s-in-the-sources"></a>16. What&#8217;s In The Sources?</h2>
<div class="sectionbody">
<div class="paragraph">
<p>We&#8217;ll briefly go through each of the sources in the Linux Source Code and try
to get an understanding of the overall structure of the source tree. Each
directory is a placeholder for certain code, scripts and files which serve
to make up the Linux Kernel project.</p>
</div>
<div class="dlist">
<dl>
<dt class="hdlist1">arch/&lt;ARCH&gt;</dt>
<dd>
<p>Architecture specific code. All code that has anything to do with the
processor the kernel is running on is present in this directory</p>
<div class="ulist">
<ul>
<li>
<p>arch/&lt;ARCH&gt;/mach-&lt;machine&gt;, machine/board specific code</p>
</li>
<li>
<p>arch/&lt;ARCH&gt;/include/asm, architecture-specific headers</p>
</li>
<li>
<p>arch/&lt;ARCH&gt;boot/dts, Device Tree source files for certain architecture</p>
</li>
</ul>
</div>
</dd>
<dt class="hdlist1">block/</dt>
<dd>
<p>Code relate to block device drivers for hard disk drives and others</p>
</dd>
<dt class="hdlist1">COPYING</dt>
<dd>
<p>License of the Linux Kernel.</p>
</dd>
<dt class="hdlist1">CREDITS</dt>
<dd>
<p>Who Did what?</p>
</dd>
<dt class="hdlist1">crypto/</dt>
<dd>
<p>Cryptographic libraries</p>
</dd>
<dt class="hdlist1">Documentation/</dt>
<dd>
<p>Documentation for all things about the Linux Kernel</p>
</dd>
<dt class="hdlist1">drivers/</dt>
<dd>
<p>Device drivers except for sound which has its own directory below</p>
</dd>
<dt class="hdlist1">firmware/</dt>
<dd>
<p>Legacy: firmware images extracted from old drivers</p>
</dd>
<dt class="hdlist1">fs/</dt>
<dd>
<p>Source code for various filesystems (ext2/ubifs/etc..)</p>
</dd>
<dt class="hdlist1">include/</dt>
<dd>
<p>Kernel headers</p>
</dd>
<dt class="hdlist1">include/linux/</dt>
<dd>
<p>Linux Kernel core headers</p>
</dd>
<dt class="hdlist1">include/uapi/</dt>
<dd>
<p>User space API headers</p>
</dd>
<dt class="hdlist1">init/</dt>
<dd>
<p>Code related to the kernel initaliazation. Includes the main.c</p>
</dd>
<dt class="hdlist1">ipc/</dt>
<dd>
<p>Code responsible for allowing inter process communication</p>
</dd>
<dt class="hdlist1">Kbuild</dt>
<dd>
<p>Part of the build system</p>
</dd>
<dt class="hdlist1">Kconfig</dt>
<dd>
<p>Top level description file for configuration parameters</p>
</dd>
<dt class="hdlist1">kernel/</dt>
<dd>
<p>The core of the Linux Kernel</p>
</dd>
<dt class="hdlist1">lib/</dt>
<dd>
<p>Useful library routines (crc32&#8230;&#8203;)</p>
</dd>
<dt class="hdlist1">MAINTAINERS</dt>
<dd>
<p>Maintainers of different subsystems of the kernel</p>
</dd>
<dt class="hdlist1">Makefile</dt>
<dd>
<p>Top level makefile</p>
</dd>
<dt class="hdlist1">mm/</dt>
<dd>
<p>Memory management code</p>
</dd>
<dt class="hdlist1">net/</dt>
<dd>
<p>Network support code</p>
</dd>
<dt class="hdlist1">README</dt>
<dd>
<p>Overview and building instructions. Read once atleast.</p>
</dd>
<dt class="hdlist1">REPORTING-BUGS</dt>
<dd>
<p>Procedure to report bugs with the Linux Kernel</p>
</dd>
<dt class="hdlist1">samples/</dt>
<dd>
<p>Sample code of usage of frameworks and kernel code</p>
</dd>
<dt class="hdlist1">scripts/</dt>
<dd>
<p>Useful scripts for internal or external use</p>
</dd>
<dt class="hdlist1">security/</dt>
<dd>
<p>Support for security features like SELinux</p>
</dd>
<dt class="hdlist1">sound/</dt>
<dd>
<p>Sound support code and drivers</p>
</dd>
<dt class="hdlist1">tools/</dt>
<dd>
<p>Code for various user space tools</p>
</dd>
<dt class="hdlist1">usr/</dt>
<dd>
<p>Code to generate an initramfs cpio archive file</p>
</dd>
<dt class="hdlist1">virt/</dt>
<dd>
<p>Virtualization support (KVM)</p>
</dd>
</dl>
</div>
</div>
</div>
<div class="sect1">
<h2 id="browsing-the-sources"><a class="anchor" href="#browsing-the-sources"></a>17. Browsing The Sources</h2>
<div class="sectionbody">
<div class="paragraph">
<p>One of the most common tasks required by any developer is the ability to browse
a project and search for:</p>
</div>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>A specific symbol such as a function name or variable name</p>
</li>
<li>
<p>The calling function of a function</p>
</li>
<li>
<p>The function definition using a function call point</p>
</li>
<li>
<p>An include file in the project from its declaration in source code</p>
</li>
<li>
<p>A pattern of text</p>
</li>
</ol>
</div>
<div class="sect2">
<h3 id="cscope"><a class="anchor" href="#cscope"></a>17.1. Cscope</h3>
<div class="paragraph">
<p>One such tool is Cscope which allows us to browse the Linux source code with ease
from editors like vim, emacs and also independently using only cscope.</p>
</div>
</div>
<div class="sect2">
<h3 id="lxr"><a class="anchor" href="#lxr"></a>17.2. LXR</h3>
<div class="paragraph">
<p>This is a generic indexing tool and code browser which is available as a web
service. It supports both C and C++ and it makes it easy to search for
declarations, definitions  and symbols. A good examples of LXR with the Linux
Kernel in action is through the <a href="http://lxr.free-electrons.com" target="_blank">Free Electrons LXR Site</a>
and further information abouit LXR can be obtained from its
<a href="http://sourceforge.net/projects/lxr" target="_blank">sourceforge page</a>.</p>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="lab-1-getting-accustomed-to-browsing-the-sources"><a class="anchor" href="#lab-1-getting-accustomed-to-browsing-the-sources"></a>18. LAB 1 : Getting Accustomed To Browsing The Sources</h2>
<div class="sectionbody">
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
<div class="title">This is a hands on session taken from the Free Electrons labs with the following objectives</div>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>Create a branch based on a remote tree to explore a particular stable kernel
version (from the stable kernel tree).</p>
</li>
<li>
<p>Explore the sources in search for files, function headers or other kinds of
information. . .</p>
</li>
<li>
<p>Browse the kernel sources with tools like cscope and LXR.</p>
</li>
</ol>
</div>
</td>
</tr>
</table>
</div>
<div class="sect2">
<h3 id="creating-a-branch-to-a-particular-stable-kernel-version"><a class="anchor" href="#creating-a-branch-to-a-particular-stable-kernel-version"></a>18.1. Creating A Branch To A Particular Stable Kernel Version</h3>
<div class="paragraph">
<p>In order to get the list of branches on our stable remote tree we have to
enter the Linux Kernel source tree and use the <em>git branch</em> command as
follows:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="bash">conrad@conrad-HP-Pavilion-dm3-Notebook-PC:~$ cd ~/git/linux
conrad@conrad-HP-Pavilion-dm3-Notebook-PC:~/git/linux$ git branch -a
* master        <i class="conum" data-value="1"></i><b>(1)</b>
  remotes/origin/HEAD -&gt; origin/master
  remotes/origin/master
  remotes/stable/linux-2.6.11.y                <i class="conum" data-value="2"></i><b>(2)</b>
  remotes/stable/linux-2.6.12.y
.
.
  remotes/stable/linux-3.9.y
  remotes/stable/master</code></pre>
</div>
</div>
<div class="colist arabic">
<table>
<tr>
<td><i class="conum" data-value="1"></i><b>1</b></td>
<td>Our source code is currently pointing to the master branch</td>
</tr>
<tr>
<td><i class="conum" data-value="2"></i><b>2</b></td>
<td>Remote stable branch remotes/stable/linux-2.6.11.y</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>We will be working with the 3.13 stable branch and so we will use the remote
branch <strong><em>remotes/stable/linux-3.13.y</em></strong> from the list of branches displayed.</p>
</div>
<div class="paragraph">
<p>Before we do anything let us check the version of our <strong><em>master</em></strong> branch using
the top level Makefile in the source code. Using <em>vim</em> or your favourite editor
or head examine the first few lines of the Makefile</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="bash">conrad@conrad-HP-Pavilion-dm3-Notebook-PC:~/git/linux$ head Makefile
VERSION = 3
PATCHLEVEL = 18
SUBLEVEL = 0
EXTRAVERSION = -rc4
NAME = Diseased Newt
.
.</code></pre>
</div>
</div>
<div class="paragraph">
<p>We can see the version of our <em>master</em> branch is at 3.18.0 -rc4 and the name
of the release is "Diseased Newt". Now let us create a local branch starting
from the stable remote branch of 3.13.y. The following command uses
<em>git checkout</em> to checkout the stable remote branch <em>stable/linux-3.13.y</em> as
a local branch with the name <em>3.13.y</em>.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="bash">conrad@conrad-HP-Pavilion-dm3-Notebook-PC:~/git/linux$ git checkout -b 3.13.y stable/linux-3.13.y        <i class="conum" data-value="1"></i><b>(1)</b>
Checking out files: 100% (27044/27044), done.
Branch 3.13.y set up to track remote branch linux-3.13.y from stable.
Switched to a new branch '3.13.y'        <i class="conum" data-value="2"></i><b>(2)</b>
conrad@conrad-HP-Pavilion-dm3-Notebook-PC:~/git/linux$
conrad@conrad-HP-Pavilion-dm3-Notebook-PC:~/git/linux$ git branch -a        <i class="conum" data-value="3"></i><b>(3)</b>
* 3.13.y        <i class="conum" data-value="4"></i><b>(4)</b>
  master
  remotes/origin/HEAD -&gt; origin/master
  remotes/origin/master
.
.</code></pre>
</div>
</div>
<div class="colist arabic">
<table>
<tr>
<td><i class="conum" data-value="1"></i><b>1</b></td>
<td>Command to checkout the stable remote branch as a local branch</td>
</tr>
<tr>
<td><i class="conum" data-value="2"></i><b>2</b></td>
<td>The switch to the new branch takes place successfully</td>
</tr>
<tr>
<td><i class="conum" data-value="3"></i><b>3</b></td>
<td>We list all the branches again</td>
</tr>
<tr>
<td><i class="conum" data-value="4"></i><b>4</b></td>
<td>The git repository now points to the <em>3.13.y</em> local branch</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>Once again let us examine the first few lines of the top level Makefile. We can
now see the version is at 3.13.11 and the name of the release is
"One Giant Leap for Frogkind". So we have successfully managed to create a
branch pointing to a stable release of the Linux Kernel source code.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="bash">conrad@conrad-HP-Pavilion-dm3-Notebook-PC:~/git/linux$ head Makefile
VERSION = 3
PATCHLEVEL = 13
SUBLEVEL = 11
EXTRAVERSION =
NAME = One Giant Leap for Frogkind
.
.</code></pre>
</div>
</div>
</div>
<div class="sect2">
<h3 id="searching-tools"><a class="anchor" href="#searching-tools"></a>18.2. Searching Tools</h3>
<div class="paragraph">
<p>There are several tools that can be used to browse the kernel code and search.
We will demonstrate the commands used with examples taken from the labs.</p>
</div>
<div class="sect3">
<h4 id="using-find"><a class="anchor" href="#using-find"></a>18.2.1. Using Find</h4>
<div class="paragraph">
<p>The <em>find</em> utility can be used to search for a specific file name. The only
catch being the name or pattern of the file needs to be known. For instance
say you want to locate the logo of Linux in the source code.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="bash">conrad@conrad-HP-Pavilion-dm3-Notebook-PC:~/git/linux$ find . -name &quot;*.gif&quot; -o -name &quot;*.jpg&quot; -o -name &quot;*.png&quot; -type f
./Documentation/logo.gif</code></pre>
</div>
</div>
<div class="paragraph">
<p>We use popular file formats to locate pictures in the source code and
coincidentally there is one file in the <em>Documentation</em> directory with the
name <em>logo.gif</em>.</p>
</div>
</div>
<div class="sect3">
<h4 id="using-git-grep"><a class="anchor" href="#using-git-grep"></a>18.2.2. Using Git-Grep</h4>
<div class="paragraph">
<p>The <em>git-grep</em> command can be used to search within a git project. For instance
if we want to search for the name of the maintainer of MVNETA network driver we
would use it as follows:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="bash">conrad@conrad-HP-Pavilion-dm3-Notebook-PC:~/git/linux$ git grep MVNETA                <i class="conum" data-value="1"></i><b>(1)</b>
MAINTAINERS:MARVELL MVNETA ETHERNET DRIVER                         <i class="conum" data-value="2"></i><b>(2)</b>
arch/arm/configs/mvebu_defconfig:CONFIG_MVNETA=y
drivers/net/ethernet/marvell/Kconfig:     This driver is used by the MV643XX_ETH and MVNETA drivers.
drivers/net/ethernet/marvell/Kconfig:config MVNETA
.
.
.</code></pre>
</div>
</div>
<div class="colist arabic">
<table>
<tr>
<td><i class="conum" data-value="1"></i><b>1</b></td>
<td>We search for MVNETA with <em>git grep</em></td>
</tr>
<tr>
<td><i class="conum" data-value="2"></i><b>2</b></td>
<td>We get the maintainers as MARVELL for MVNETA ETHERNET DRIVER</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>To get line numbers for the references of the regex being searched we have
to set the environment for git. This can be done locally (--local) specific
to the git project or globally(--global) for all git projects on the workstation.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="bash">conrad@conrad-HP-Pavilion-dm3-Notebook-PC:~/git/linux$ git config --local grep.lineNumber true                <i class="conum" data-value="1"></i><b>(1)</b></code></pre>
</div>
</div>
<div class="colist arabic">
<table>
<tr>
<td><i class="conum" data-value="1"></i><b>1</b></td>
<td>Enabling line numbers in the search in my local linux git clone</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>It is possible to search in a specific branch of the project with
<em>git-grep</em>. For instance let us try to find the <em>platform_device_register</em>
function in all header files in the linux project in the branch
<em>remotes/stable/linux-3.7.y</em></p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="bash">conrad@conrad-HP-Pavilion-dm3-Notebook-PC:~/git/linux$ git grep -e platform_device_register remotes/stable/linux-3.7.y -- '*.h'         <i class="conum" data-value="1"></i><b>(1)</b>
remotes/stable/linux-3.7.y:arch/arm/mach-ux500/devices-common.h:99:     return platform_device_register_full(&amp;pdevinfo);
remotes/stable/linux-3.7.y:arch/arm/mach-ux500/devices-common.h:123:    return platform_device_register_full(&amp;pdevinfo);
remotes/stable/linux-3.7.y:arch/arm/mach-ux500/devices-common.h:140:    platform_device_register_full(&amp;pdevinfo);
remotes/stable/linux-3.7.y:arch/arm/mach-ux500/devices-db8500.h:26:     return platform_device_register_resndata(parent, &quot;nmk-ske-keypad&quot;, -1,
remotes/stable/linux-3.7.y:arch/arm/plat-mxc/include/mach/devices-common.h:31:  return platform_device_register_full(&amp;pdevinfo);
remotes/stable/linux-3.7.y:include/linux/platform_device.h:43:extern int platform_device_register(struct platform_device *);                <i class="conum" data-value="2"></i><b>(2)</b>
remotes/stable/linux-3.7.y:include/linux/platform_device.h:69:extern struct platform_device *platform_device_register_full(
remotes/stable/linux-3.7.y:include/linux/platform_device.h:73: * platform_device_register_resndata - add a platform-level device with
remotes/stable/linux-3.7.y:include/linux/platform_device.h:86:static inline struct platform_device *platform_device_register_resndata(
remotes/stable/linux-3.7.y:include/linux/platform_device.h:102: return platform_device_register_full(&amp;pdevinfo);
remotes/stable/linux-3.7.y:include/linux/platform_device.h:106: * platform_device_register_simple - add a platform-level device and its resources
remotes/stable/linux-3.7.y:include/linux/platform_device.h:127:static inline struct platform_device *platform_device_register_simple(
remotes/stable/linux-3.7.y:include/linux/platform_device.h:131: return platform_device_register_resndata(NULL, name, id,
remotes/stable/linux-3.7.y:include/linux/platform_device.h:136: * platform_device_register_data - add a platform-level device with platform-specific data
remotes/stable/linux-3.7.y:include/linux/platform_device.h:151:static inline struct platform_device *platform_device_register_data(
remotes/stable/linux-3.7.y:include/linux/platform_device.h:155: return platform_device_register_resndata(parent, name, id,</code></pre>
</div>
</div>
<div class="colist arabic">
<table>
<tr>
<td><i class="conum" data-value="1"></i><b>1</b></td>
<td>Expression searches for <em>platform_device_register</em> declaration in <em>remotes/stable/linux-3.7.y</em></td>
</tr>
<tr>
<td><i class="conum" data-value="2"></i><b>2</b></td>
<td>The function is declared on line 43 in <em>include/linux/platform_device.h</em> in the branch <em>linux-3.7.y</em></td>
</tr>
</table>
</div>
<div class="paragraph">
<p>If we compare it to one of the older stable branches of <em>remotes/stable/linux-2.6.11.y</em>
we get fewer header files with reference to the function name.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="bash">conrad@conrad-HP-Pavilion-dm3-Notebook-PC:~/git/linux$ git grep -e platform_device_register remotes/stable/linux-2.6.11.y -- '*.h'        <i class="conum" data-value="1"></i><b>(1)</b>
remotes/stable/linux-2.6.11.y:include/asm-ppc/ppc_sys.h:54:/* Update all memory resources by paddr, call before platform_device_register */
remotes/stable/linux-2.6.11.y:include/asm-ppc/ppc_sys.h:58:/* Get platform_data pointer out of platform device, call before platform_device_register */
remotes/stable/linux-2.6.11.y:include/linux/device.h:380:extern int platform_device_register(struct platform_device *);                        <i class="conum" data-value="2"></i><b>(2)</b>
remotes/stable/linux-2.6.11.y:include/linux/device.h:392:extern struct platform_device *platform_device_register_simple(char *, unsigned int, struct resource *, unsigned int);</code></pre>
</div>
</div>
<div class="colist arabic">
<table>
<tr>
<td><i class="conum" data-value="1"></i><b>1</b></td>
<td>Expression searches for <em>platform_device_register</em> declaration in <em>remotes/stable/linux-2.6.11.y</em></td>
</tr>
<tr>
<td><i class="conum" data-value="2"></i><b>2</b></td>
<td>The function is declared on line 380 in <em>include/linux/platform_device.h</em> in the branch <em>linux-2.6.11.y</em></td>
</tr>
</table>
</div>
</div>
<div class="sect3">
<h4 id="using-linux-cross-reference"><a class="anchor" href="#using-linux-cross-reference"></a>18.2.3. Using Linux Cross Reference</h4>
<div class="paragraph">
<p>We can make use of an automated tool like Linux Cross Reference or
LXR as well:</p>
</div>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>Identifier search: <a href="http://lxr.free-electrons.com/ident" target="_blank">http://lxr.free-electrons.com/ident</a></p>
</li>
<li>
<p>Free text search: <a href="http://lxr.free-electrons.com/search">http://lxr.free-electrons.com/search</a></p>
</li>
</ol>
</div>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="configuring-the-kernel"><a class="anchor" href="#configuring-the-kernel"></a>19. Configuring The Kernel</h2>
<div class="sectionbody">
<div class="paragraph">
<p>The kernel source code contains code to support many filesystems, device
drivers, network protocols, architectures, etc. The source code can be
configured to chose which features are required based on the type of
applications that will be run in user space.</p>
</div>
<div class="paragraph">
<p>Additionally the kernel configuration will also support test code that
may be run to validate device drivers in the system. For example the
MTD system has several kernel modules which can be loaded to validate
the implementation of the mtd device driver code for the flash storage
in the system.</p>
</div>
<div class="paragraph">
<p>To support this type of configuration there are a series of Makefiles
present in the kernel source code. However to start the configuraton
and build we would only be required to work with the top level
<em>Makefile</em>.</p>
</div>
<div class="paragraph">
<p>There are various targets defined in the top level Makefile which can
control the configuration, build and installation of the Linux kernel.</p>
</div>
<div class="paragraph">
<p>To get a sense of the number of targets available we can run <em>make help</em>
to see all the targets.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="bash">conrad@conrad-HP-Pavilion-dm3-Notebook-PC:~/Git/linux$ make help | head
Cleaning targets:
  clean                  - Remove most generated files but keep the config and
                    enough build support to build external modules
  mrproper          - Remove all generated files + config + various backup files
  distclean          - mrproper + remove editor backup and patch files

Configuration targets:
  config          - Update current config utilising a line-oriented program
  nconfig         - Update current config utilising a ncurses menu based program
  menuconfig          - Update current config utilising a menu based program
.
.
.</code></pre>
</div>
</div>
<div class="sect2">
<h3 id="kernel-configuration"><a class="anchor" href="#kernel-configuration"></a>19.1. Kernel Configuration</h3>
<div class="paragraph">
<p>The process of configuring the Linux Kernel includes modifying the
configuration file located at the root of the source code. This file
is named <em>.config</em>. The dot at the beginning of the file name indicates
that it is a hidden file.</p>
</div>
<div class="paragraph">
<p>The syntax of this file is in the form of simple key value pairs as shown
in the example below:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="bash">conrad@conrad-HP-Pavilion-dm3-Notebook-PC:~/Git/linux$ head .config        <i class="conum" data-value="1"></i><b>(1)</b>
#
# Automatically generated file; DO NOT EDIT.
# Linux/x86 3.12.0-rc7 Kernel Configuration
#
# CONFIG_64BIT is not set                <i class="conum" data-value="2"></i><b>(2)</b>
CONFIG_X86_32=y
CONFIG_X86=y
CONFIG_INSTRUCTION_DECODER=y
CONFIG_OUTPUT_FORMAT=&quot;elf32-i386&quot;
CONFIG_ARCH_DEFCONFIG=&quot;arch/x86/configs/i386_defconfig&quot;
.
.
.</code></pre>
</div>
</div>
<div class="colist arabic">
<table>
<tr>
<td><i class="conum" data-value="1"></i><b>1</b></td>
<td>Command to display the first lines of the <em>.config</em> file</td>
</tr>
<tr>
<td><i class="conum" data-value="2"></i><b>2</b></td>
<td><em>#</em> is used to comment out key values in the configuration file</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>An important point to note is that because options have dependencies it is
not advisable to edit the <em>.config</em> file by hand. Preferably use the available
configuration interfaces.</p>
</div>
<div class="dlist">
<dl>
<dt class="hdlist1">Graphical Interfaces</dt>
<dd>
<p><em>make xconfig</em> OR <em>make gconfig</em></p>
</dd>
<dt class="hdlist1">Text/Shell Interfaces</dt>
<dd>
<p><em>make menuconfig</em> OR <em>make nconfig</em></p>
</dd>
</dl>
</div>
<div class="paragraph">
<p>It doesn&#8217;t make any difference which is used and we can shift between either
of the interfaces as they all edit the same <em>.config</em> file.</p>
</div>
<div class="sect3">
<h4 id="kernel-configuration-in-the-system"><a class="anchor" href="#kernel-configuration-in-the-system"></a>19.1.1. Kernel Configuration In The System</h4>
<div class="paragraph">
<p>The configuration of a GNU/Linux distribution is usually present along with the
kernel image in the <em>/boot/</em> directory.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="bash">conrad@conrad-HP-Pavilion-dm3-Notebook-PC:~/Git/linux$ uname -r                <i class="conum" data-value="1"></i><b>(1)</b>
3.13.0-45-generic                                                        <i class="conum" data-value="2"></i><b>(2)</b>
conrad@conrad-HP-Pavilion-dm3-Notebook-PC:~/Git/linux$ ls -l /boot/config-3.13.0-45-generic         <i class="conum" data-value="3"></i><b>(3)</b>
-rw-r--r-- 1 root root 169818 Jan 14 01:53 /boot/config-3.13.0-45-generic                        <i class="conum" data-value="4"></i><b>(4)</b>
conrad@conrad-HP-Pavilion-dm3-Notebook-PC:~/Git/linux$</code></pre>
</div>
</div>
<div class="colist arabic">
<table>
<tr>
<td><i class="conum" data-value="1"></i><b>1</b></td>
<td><em>uname -r</em> is the command to get the kernel running on the system</td>
</tr>
<tr>
<td><i class="conum" data-value="2"></i><b>2</b></td>
<td>The kernel running is <em>3.13.0-45-generic</em></td>
</tr>
<tr>
<td><i class="conum" data-value="3"></i><b>3</b></td>
<td>Listing the configuration file of this kernel in <em>/boot/</em></td>
</tr>
<tr>
<td><i class="conum" data-value="4"></i><b>4</b></td>
<td>The configuration file is <em>config-3.13.0-45-generic</em></td>
</tr>
</table>
</div>
</div>
</div>
<div class="sect2">
<h3 id="configuring-features-as-modules"><a class="anchor" href="#configuring-features-as-modules"></a>19.2. Configuring Features As Modules</h3>
<div class="paragraph">
<p>Upon configuring the kernel source and completion of the build we get
a single image which represents the kernel and all the features it is
configured for. However it is possible to configure some of the features
such as device drivers, filesystems, driver tests, etc. as separate
entities called <strong>kernel modules</strong>.</p>
</div>
<div class="paragraph">
<p>By configuring certain features as modules we are able to keep the size
of the kernel to a minimum. Kernel modules can be loaded from user space
to support certain applications on execution or on insertion of certain
devices into the system buses like USB, PCI, etc..</p>
</div>
<div class="paragraph">
<p>Therefore in the configuration of certain features it is possible to select
if the feature needs to be compiled as a kernel module. All kernel modules
will have to be stored in a file system and will have to be loaded into the
running kernel by some user space application or script.</p>
</div>
<div class="paragraph">
<p>An important point to note in choosing if a feature should be compiled as
a module is the latency with which the feature needs to be activated from
boot of the system. As the kernel module is stored in a filesystem, it will
not be loadable until the filesystem is mounted in the kernel.</p>
</div>
</div>
<div class="sect2">
<h3 id="kernel-option-types"><a class="anchor" href="#kernel-option-types"></a>19.3. Kernel Option Types</h3>
<div class="paragraph">
<p>When selecting different features and configuring the kernel we come across
different types based on the information required to complete the
configuration.</p>
</div>
<div class="dlist">
<dl>
<dt class="hdlist1">bool</dt>
<dd>
<p><em>true</em> or <em>false</em> to indicate presence or absence of the feature
respectively.</p>
</dd>
<dt class="hdlist1">tristate</dt>
<dd>
<p><em>true</em> or <em>false</em> similar to bool option types and also a third
state i.e. <em>module</em> to indicate it is a kernel module.</p>
</dd>
<dt class="hdlist1">int</dt>
<dd>
<p>If an integer value is required in the configuration of the feature.</p>
</dd>
<dt class="hdlist1">hex</dt>
<dd>
<p>If a hexadecimal value is required in the configuration of the feature.</p>
</dd>
<dt class="hdlist1">string</dt>
<dd>
<p>If a string value is requried in the configuration of the feature.</p>
</dd>
</dl>
</div>
</div>
<div class="sect2">
<h3 id="kernel-option-dependencies"><a class="anchor" href="#kernel-option-dependencies"></a>19.4. Kernel Option Dependencies</h3>
<div class="paragraph">
<p>There will be dependencies between different kernel objects. To describe
the dependency there are two types:</p>
</div>
<div class="dlist">
<dl>
<dt class="hdlist1">depends on dependencies</dt>
<dd>
<p>The option that is dependent on another remains
invisible until the later is enabled.</p>
</dd>
<dt class="hdlist1">select dependencies</dt>
<dd>
<p>The option on selection automatically selects the
object on which it depends on in the configuration.</p>
</dd>
</dl>
</div>
</div>
<div class="sect2">
<h3 id="graphical-configuration-interface-em-xconfig-em"><a class="anchor" href="#graphical-configuration-interface-em-xconfig-em"></a>19.5. Graphical Configuration Interface <em>xconfig</em></h3>
<div class="paragraph">
<p>The xconfig configuration utitlity which uses Qt is invoked when running
<em>make xconfig</em> in the root directory. If we try to invoke it we get the
following error:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="bash">conrad@conrad-HP-Pavilion-dm3-Notebook-PC:~$ cd ~/Git/linux
conrad@conrad-HP-Pavilion-dm3-Notebook-PC:~/Git/linux$ make xconfig
  CHECK   qt                                                                <i class="conum" data-value="1"></i><b>(1)</b>
* Unable to find the QT4 tool qmake. Trying to use QT3
*
* Unable to find any QT installation. Please make sure that
* the QT4 or QT3 development package is correctly installed and
* either qmake can be found or install pkg-config or set
* the QTDIR environment variable to the correct location.                <i class="conum" data-value="2"></i><b>(2)</b>
*
make[1]: *** No rule to make target `scripts/kconfig/.tmp_qtcheck', needed by `scripts/kconfig/qconf.o'.  Stop.
make: *** [xconfig] Error 2
conrad@conrad-HP-Pavilion-dm3-Notebook-PC:~/Git/linux$</code></pre>
</div>
</div>
<div class="colist arabic">
<table>
<tr>
<td><i class="conum" data-value="1"></i><b>1</b></td>
<td>The target rule checks for qt</td>
</tr>
<tr>
<td><i class="conum" data-value="2"></i><b>2</b></td>
<td>A nice description of what is probably wrong with our Ubuntu distribution</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>Ok we need to install Qt in our system. The dependencies are <em>libqt4-dev</em>
and <em>g++</em>. For older kernel sources the dependencies are <em>libqt3-mt-dev</em>.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="bash">conrad@conrad-HP-Pavilion-dm3-Notebook-PC:~/Git/linux$ sudo apt-get install libqt4-dev g++        <i class="conum" data-value="1"></i><b>(1)</b>
Reading package lists... Done
Building dependency tree
Reading state information... Done
.
.
.
Setting up libqtwebkit-dev (2.3.2-0ubuntu7) ...
Processing triggers for libc-bin (2.19-0ubuntu6.5) ...</code></pre>
</div>
</div>
<div class="colist arabic">
<table>
<tr>
<td><i class="conum" data-value="1"></i><b>1</b></td>
<td>Installing the prerequisites</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>Again we try running <em>make xconfig</em> and see the graphical interface as shown
in the screen capture below:</p>
</div>
<div class="exampleblock">
<div class="content">
<div id="beagleboneblacktux-make-xconfig-screenshot" class="imageblock" style="text-align: center">
<div class="content">
<a class="image" href="images/make-xconfig-screenshot.png"><img src="http://zeuzoix.github.io/techeuphoria/images/make-xconfig-screenshot.png" alt="make xconfig screenshot" width="640" height="480"></a>
</div>
<div class="title">Screenshot of xconfig interface</div>
</div>
</div>
</div>
<div class="paragraph">
<p>It is possible to search for a particular feature using the search interface.
This can be invoked with a <strong>CTRL + F</strong> keyboard combination.</p>
</div>
<div class="exampleblock">
<div class="content">
<div id="beagleboneblacktux-make-xconfig-search" class="imageblock" style="text-align: center">
<div class="content">
<a class="image" href="images/make-xconfig-search-imx.png"><img src="http://zeuzoix.github.io/techeuphoria/images/make-xconfig-search-imx.png" alt="make xconfig search imx" width="640" height="480"></a>
</div>
<div class="title">Screenshot of xconfig search</div>
</div>
</div>
</div>
</div>
<div class="sect2">
<h3 id="graphical-configuration-interface-em-gconfig-em"><a class="anchor" href="#graphical-configuration-interface-em-gconfig-em"></a>19.6. Graphical Configuration Interface <em>gconfig</em></h3>
<div class="paragraph">
<p>Another graphical interface is the <em>gconfig</em> target.This GTK based configuration
gives the following error when we invoke it:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="bash">conrad@conrad-HP-Pavilion-dm3-Notebook-PC:~/Git/linux$ make gconfig                <i class="conum" data-value="1"></i><b>(1)</b>
*
* Unable to find the GTK+ installation. Please make sure that
* the GTK+ 2.0 development package is correctly installed...
* You need gtk+-2.0, glib-2.0 and libglade-2.0.                                        <i class="conum" data-value="2"></i><b>(2)</b>
*
make[1]: *** No rule to make target `scripts/kconfig/.tmp_gtkcheck', needed by `scripts/kconfig/gconf.o'.  Stop.
make: *** [gconfig] Error 2</code></pre>
</div>
</div>
<div class="colist arabic">
<table>
<tr>
<td><i class="conum" data-value="1"></i><b>1</b></td>
<td>We invoke the target gconfig of the root directory makefile</td>
</tr>
<tr>
<td><i class="conum" data-value="2"></i><b>2</b></td>
<td>A helpful message indicates a missing GTK+ installation in our Ubun</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>In this case we have to install the debian package <em>libglade2-dev</em></p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="bash">conrad@conrad-HP-Pavilion-dm3-Notebook-PC:~/Git/linux$ sudo apt-get install libglade2-dev
[sudo] password for conrad:
no talloc stackframe at ../source3/param/loadparm.c:4864, leaking memory
Reading package lists... Done
Building dependency tree
Reading state information... Done
.
.
.</code></pre>
</div>
</div>
</div>
<div class="sect2">
<h3 id="text-configuration-interface-em-menuconfig-em"><a class="anchor" href="#text-configuration-interface-em-menuconfig-em"></a>19.7. Text Configuration Interface <em>menuconfig</em></h3>
<div class="paragraph">
<p>This configuration interface requires no graphical interface and only
requires the <em>libncurses-dev</em> debian package to be installed. This interface
is popular with other projects such as Linux Target Image Builder (LTIB),
Busybox, OpenWrt, etc.. It works well enough for us to ignore the graphical
interfaces. It is brought up using a <em>make menuconfig</em> command in the root
directory.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="bash">conrad@conrad-HP-Pavilion-dm3-Notebook-PC:~/Git/linux$ make menuconfig</code></pre>
</div>
</div>
<div class="paragraph">
<p>We get the following screen shot one the interface is invoked from the shell.</p>
</div>
<div class="exampleblock">
<div class="content">
<div id="beagleboneblacktux-make-menuconfig-screenshot" class="imageblock" style="text-align: center">
<div class="content">
<a class="image" href="images/make-menuconfig-screenshot.png"><img src="http://zeuzoix.github.io/techeuphoria/images/make-menuconfig-screenshot.png" alt="make menuconfig screenshot" width="640" height="480"></a>
</div>
<div class="title">Screenshot of menuconfig interface</div>
</div>
</div>
</div>
<div class="paragraph">
<p>Searching with the <em>menuconfig</em> interface is done by hitting the '/' key similar
to <em>vim</em>. Once the search page is displayed we can enter a key word for the
search.</p>
</div>
<div class="exampleblock">
<div class="content">
<div id="beagleboneblacktux-make-menuconfig-search-imx" class="imageblock" style="text-align: center">
<div class="content">
<a class="image" href="images/make-menuconfig-search-imx.png"><img src="http://zeuzoix.github.io/techeuphoria/images/make-menuconfig-search-imx.png" alt="make menuconfig search imx" width="640" height="480"></a>
</div>
<div class="title">Screenshot of menuconfig search</div>
</div>
</div>
</div>
<div class="paragraph">
<p>The results of the search are displayed as follows:</p>
</div>
<div class="exampleblock">
<div class="content">
<div id="beagleboneblacktux-make-menuconfig-search-results" class="imageblock" style="text-align: center">
<div class="content">
<a class="image" href="images/make-menuconfig-search-imx-results.png"><img src="http://zeuzoix.github.io/techeuphoria/images/make-menuconfig-search-imx-results.png" alt="make menuconfig search imx results" width="640" height="480"></a>
</div>
<div class="title">Screenshot of menuconfig search results</div>
</div>
</div>
</div>
</div>
<div class="sect2">
<h3 id="text-configuration-interface-em-nconfig-em"><a class="anchor" href="#text-configuration-interface-em-nconfig-em"></a>19.8. Text Configuration Interface <em>nconfig</em></h3>
<div class="paragraph">
<p>Another similar test based configuration interface is <em>nconfig</em> with the same
dependency on <em>libncurses_dev</em> debian package. Again to invoke the interface
we will have to use <em>make nconfig</em>.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="bash">conrad@conrad-HP-Pavilion-dm3-Notebook-PC:~/Git/linux$ make nconfig</code></pre>
</div>
</div>
<div class="paragraph">
<p>We get the following screen shot once the interface is invoked from the shell.</p>
</div>
<div class="exampleblock">
<div class="content">
<div id="beagleboneblacktux-make-nconfig-screenshot" class="imageblock" style="text-align: center">
<div class="content">
<a class="image" href="images/make-nconfig-screenshot.png"><img src="http://zeuzoix.github.io/techeuphoria/images/make-nconfig-screenshot.png" alt="make nconfig screenshot" width="640" height="480"></a>
</div>
<div class="title">Screenshot of nconfig interface</div>
</div>
</div>
</div>
</div>
<div class="sect2">
<h3 id="make-oldconfig"><a class="anchor" href="#make-oldconfig"></a>19.9. make oldconfig</h3>
<div class="paragraph">
<p>If we are upgrading to a newer release and use the <em>.config</em> file from an older
release of the Linux kernel then we need to run <em>make oldconfig</em>. This will
inform us of the configuration settings that are irrelevant in the newer release
and if there are newer features or parameters then it will prompt us asking for
appropriate values for these settings.</p>
</div>
<div class="paragraph">
<p>Another scenario in which <em>make oldconfig</em> may come in use is if we modify the
<em>.config</em> file by hand.</p>
</div>
</div>
<div class="sect2">
<h3 id="reverting-to-a-previous-configuration"><a class="anchor" href="#reverting-to-a-previous-configuration"></a>19.10. Reverting To A Previous Configuration</h3>
<div class="paragraph">
<p>If we mess up our configuration and build a kernel that is unusable then we can
revert to the older configuration that the kernel was built. This is done by
copyting the <em>.config.old</em> file which gets created if we use any of the
configuration interfaces available. All the interfaces save a copy of the
existing configuration file <em>.config</em> as a back up in <em>.config.old</em></p>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="compiling-the-kernel"><a class="anchor" href="#compiling-the-kernel"></a>20. Compiling The Kernel</h2>
<div class="sectionbody">
<div class="paragraph">
<p>After configuring the kernel with one of the configuration interfaces we can
proceed to build the kernel by issuing a <em>make</em> command in the root directory.
If blessed with multiple CPU cores then the build can be speed up using a
<em>make -j 4</em> command which instructs make to run 4 jobs in parallel.</p>
</div>
<div class="paragraph">
<p>After the build the following will be generated:</p>
</div>
<div class="dlist">
<dl>
<dt class="hdlist1">vmlinux</dt>
<dd>
<p>Raw and uncompressed image which can be used for debugging purposes.
This image cannot be booted.</p>
</dd>
<dt class="hdlist1">arch/&lt;ARCH&gt;/boot/*Image</dt>
<dd>
<p>The final kernel image which can be booted e.g.
bzImage for x86 and zImage for ARM. There may also be compressed images
generated.</p>
</dd>
<dt class="hdlist1">arch/&lt;ARCH&gt;/boot/dts/*.dtb</dt>
<dd>
<p>Compiled Device Tree files for certain
architectures. This will be loaded by the bootloader before the kernel image.</p>
</dd>
<dt class="hdlist1">kernel modules(*.ko)</dt>
<dd>
<p>This will be generated in the directory corresponding
to the driver/feature for which module type of configuration option was
selected.</p>
</dd>
</dl>
</div>
</div>
</div>
<div class="sect1">
<h2 id="kernel-installation"><a class="anchor" href="#kernel-installation"></a>21. Kernel Installation</h2>
<div class="sectionbody">
<div class="paragraph">
<p>A kernel compiled for the host machine on which it is built can be installed
in the system by issuing a <em>make install</em> after the build is successful. To
install the kernel image we would required root permissions.</p>
</div>
<div class="paragraph">
<p>The installation includes the following:</p>
</div>
<div class="dlist">
<dl>
<dt class="hdlist1">/boot/vmlinuz-&lt;version&gt;</dt>
<dd>
<p>The compressed kernel image. This is copied from
the <em>arch/&lt;ARCH&gt;/boot</em> directory.</p>
</dd>
<dt class="hdlist1">/boot/System.map-&lt;version&gt;</dt>
<dd>
<p>This file stores the kernel symbols along with
their addresses and will be handy in the event of a Kernel panic</p>
</dd>
<dt class="hdlist1">/boot/config-&lt;version&gt;</dt>
<dd>
<p>This is the configuration file <em>.config</em> saved
along with the compiled kernel</p>
</dd>
</dl>
</div>
<div class="paragraph">
<p>The installation may also reconfigured the bootloader to take the new
kernel settings so that on the next boot the new kernel will be visible.</p>
</div>
<div class="sect2">
<h3 id="kernel-module-installation"><a class="anchor" href="#kernel-module-installation"></a>21.1. Kernel Module Installation</h3>
<div class="paragraph">
<p>Along with the kernel the compiled modules will also have to be installed
in the system. To achieve this there is a target <em>modules_install</em> which
can be executed after executing the <em>install</em> target of the root makefile.</p>
</div>
<div class="paragraph">
<p>The kernel modules and related files are installed in the
<em>/lib/modules/&lt;version&gt;/</em> directory. If we explore this directory we will
see the following:</p>
</div>
<div class="dlist">
<dl>
<dt class="hdlist1">kernel/</dt>
<dd>
<p>This directory contains a directory structure similar to the
kernel source code. The kernel modules will be saved in the same directory
structure as the source from which they were built.</p>
</dd>
<dt class="hdlist1">modules.alias</dt>
<dd>
<p>Aliases for the modules for loading utilities. An example
of the contents of this file is given below:</p>
</dd>
</dl>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="bash">conrad@conrad-HP-Pavilion-dm3-Notebook-PC:~$ head /lib/modules/3.13.0-45-generic/modules.alias
# Aliases extracted from modules themselves.
alias char-major-10-134 apm
alias aes-asm aes_i586
alias aes aes_i586
alias twofish-asm twofish_i586
alias twofish twofish_i586
alias salsa20-asm salsa20_i586
alias salsa20 salsa20_i586
alias serpent serpent_sse2_i586
alias aes aesni_intel</code></pre>
</div>
</div>
<div class="dlist">
<dl>
<dt class="hdlist1">modules.dep</dt>
<dd>
<p>Highlights the dependencies between modules. This will be used by
<em>modprobe</em> to choose which kernel modules have to be loaded before loading a
particular module. In the example below mce_inject.ko has no dependency and can
be loaded without any issue. But twofish-i586.ko depends on twofish_common.ko
which must be loaded first.</p>
</dd>
</dl>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="bash">conrad@conrad-HP-Pavilion-dm3-Notebook-PC:~$ head /lib/modules/3.13.0-45-generic/modules.dep
kernel/arch/x86/kernel/cpu/mcheck/mce-inject.ko:
kernel/arch/x86/kernel/msr.ko:
kernel/arch/x86/kernel/cpuid.ko:
kernel/arch/x86/kernel/apm.ko:
kernel/arch/x86/crypto/glue_helper.ko:
kernel/arch/x86/crypto/aes-i586.ko:
kernel/arch/x86/crypto/twofish-i586.ko: kernel/crypto/twofish_common.ko
kernel/arch/x86/crypto/salsa20-i586.ko:
kernel/arch/x86/crypto/serpent-sse2-i586.ko: kernel/crypto/xts.ko kernel/crypto/serpent_generic.ko kernel/crypto/lrw.ko kernel/crypto/gf128mul.ko kernel/arch/x86/crypto/glue_helper.ko kernel/crypto/ablk_helper.ko kernel/crypto/cryptd.ko
kernel/arch/x86/crypto/aesni-intel.ko: kernel/arch/x86/crypto/aes-i586.ko kernel/crypto/xts.ko kernel/crypto/lrw.ko kernel/crypto/gf128mul.ko kernel/crypto/ablk_helper.ko kernel/crypto/cryptd.ko</code></pre>
</div>
</div>
<div class="dlist">
<dl>
<dt class="hdlist1">modules.symbols</dt>
<dd>
<p>Describes the kernel module to which a symbol belongs. It can
be useful during debugging of a Kernel panic. For example we can see that
cfg80211_report_obss_beacon belongs to the cfg80211 kernel module.</p>
</dd>
</dl>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="bash">conrad@conrad-HP-Pavilion-dm3-Notebook-PC:~$ head /lib/modules/3.13.0-45-generic/modules.symbols
# Aliases for symbols, used by symbol_request().
alias symbol:cfg80211_report_obss_beacon cfg80211
alias symbol:drm_dp_link_train_channel_eq_delay drm_kms_helper
alias symbol:VBoxHost_RTThreadPreemptDisable vboxdrv
alias symbol:__twofish_setkey twofish_common
alias symbol:get_wd_exp_mode_sd bpctl_mod
alias symbol:hsi_register_controller hsi
alias symbol:mlx4_db_free mlx4_core
alias symbol:sdhci_remove_host sdhci
alias symbol:videobuf_dma_init_kernel videobuf_dma_sg</code></pre>
</div>
</div>
</div>
<div class="sect2">
<h3 id="cleaning-up"><a class="anchor" href="#cleaning-up"></a>21.2. Cleaning Up</h3>
<div class="paragraph">
<p>There are several targets that are used to clean up files that have been
generated by the configuration and compilation of the Linux kernel source
code.</p>
</div>
<div class="dlist">
<dl>
<dt class="hdlist1">make clean</dt>
<dd>
<p>This will remove all the generated object code files to allow
us to rebuilt the kernel.</p>
</dd>
<dt class="hdlist1">make mrproper</dt>
<dd>
<p>Remove all the generated files including the configuration
file <em>.config</em>. It may be used if we are rebuilding the kernel source
code for a different architecture.</p>
</dd>
<dt class="hdlist1">make distclean</dt>
<dd>
<p>This target is used to remove editor backup files. It is
mainly used when generating patches.</p>
</dd>
</dl>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="cross-compiling-the-kernel"><a class="anchor" href="#cross-compiling-the-kernel"></a>22. Cross-Compiling The Kernel</h2>
<div class="sectionbody">
<div class="paragraph">
<p>When we work with embedded targets such as the Beagle Bone Black board
we have to compile the kernel for the architecture of that board i.e.
ARM. A kernel compiled on our x86 workstation will not execute on the
Beagle Bone Black because it is compiled for an x86 architecture.</p>
</div>
<div class="paragraph">
<p>The process of compiling the kernel on our work station for another
architecture is referred to as cross-compilation. The kernel can be
compiled on the Beagle Bone Black if it has a toolchain installed on
it. However as the processing power of embedded targets is much lower
than that of PCs and servers it becomes more efficient to employ
a cross-compilation toolchain for embedded development.</p>
</div>
<div class="paragraph">
<p>A cross-compiler can be recognized by its prefix which indicates
the system for which it will compile the source code. For example
<em>mips-linux-gcc</em> indicates that the cross-compiler will generate
a binary that can be executed on a MIPS based architecture whereas
a <em>arm-linux-gnueabi-gcc</em> indicates that the cross-compiler will
generate a binary that can be executed on an ARM based architecture.</p>
</div>
<div class="paragraph">
<p>To specify the architecture for which the kernel source code is
to be compiled we have to pass a variable <strong><em>ARCH</em></strong> to the top level
makefile. This should map to any of the subdirectories in the
<em>arch/</em> directory of the kernel source code e.g. <em>arm</em>.</p>
</div>
<div class="paragraph">
<p>To specify the cross compilation toolchain we have to pass the
<strong><em>CROSS_COMPILE</em></strong> variable which represents the prefix of the
toolchain e.g. <em>mips-linux-</em> or <em>arm-linux-gnueabi-</em>.</p>
</div>
<div class="sect2">
<h3 id="predefined-configuration-files"><a class="anchor" href="#predefined-configuration-files"></a>22.1. Predefined Configuration Files</h3>
<div class="paragraph">
<p>Many times when working with embedded boards we don&#8217;t set the configuration
of a particular board from scratch. It is easier if there is a predefined
configuration with which we can start from and there is in most cases. We
get a list of predefined configurations from <em>make help</em> which allows us to
set the <em>.config</em> to a particular configuration for a specific board.</p>
</div>
<div class="paragraph">
<p>For instance if we run <em>make viper_defconfig</em> it will overwrite the <em>.config</em>
file with the file from <em>arch/arm/configs/viper_defconfig</em>. To get a list of
default configurations we can either use <em>make help</em> or the find utility as
shown below:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="bash">conrad@conrad-HP-Pavilion-dm3-Notebook-PC:~/Git/linux$ find . -name *_defconfig |head
./arch/arc/configs/tb10x_defconfig
./arch/arc/configs/fpga_defconfig
./arch/arc/configs/fpga_noramfs_defconfig
./arch/arc/configs/nsimosci_defconfig
./arch/mn10300/configs/asb2364_defconfig
.
.
.
./arch/ia64/configs/sim_defconfig
./arch/ia64/configs/tiger_defconfig
./arch/xtensa/configs/iss_defconfig
./arch/xtensa/configs/s6105_defconfig
./arch/xtensa/configs/common_defconfig</code></pre>
</div>
</div>
<div class="paragraph">
<p>Once we&#8217;ve loaded a default configuration which is basically a minimal
configuration it&#8217;s time to tailor the configuration to our specifications.
This will include running one of the configuration interfaces like
<em>make menuconfig</em>. We see the settings of the default configuration in the
interface.</p>
</div>
</div>
<div class="sect2">
<h3 id="saving-our-default-configuration"><a class="anchor" href="#saving-our-default-configuration"></a>22.2. Saving Our Default Configuration</h3>
<div class="paragraph">
<p>We also have the ability to save our configuration once it is tailored, as
a default configuration. This can be done by running the command
<em>make savedefconfig</em>. Running this target causes make to save the <em>.config</em>
file with a name <em>defconfig</em>. We can move the new <em>defconfig</em> file to
the architecture <em>configs</em> directory with an appropriate name.</p>
</div>
<div class="ulist">
<ul>
<li>
<p>mv defconfig arch/&lt;ARCH&gt;/configs/my_favourite_config</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>Overall the choice of starting from a default minimal configuration lies with
the developer. We can also start from scratch but be mindful about selection of
the CPU selection and the correct device drivers.</p>
</div>
</div>
<div class="sect2">
<h3 id="device-tree"><a class="anchor" href="#device-tree"></a>22.3. Device Tree</h3>
<div class="paragraph">
<p>Most embedded platforms have non-discoverable hardware which exists as part
of the SOC. This hardware has to be described to the kernel in the form of
code or a special hardware description language called <em>Device Tree</em>.</p>
</div>
<div class="paragraph">
<p>The <em>Device Tree</em> language is used only recently in certain architectures
such as ARM, PowerPC, ARC, etc.. The Device Tree source file is compiled
into a binary called Device Tree Blob by a compiler and passed to the kernel
through the bootloader. Each board will have its own unique hardware and
therefore will have a unique device tree source file.</p>
</div>
<div class="paragraph">
<p>The <em>Device Tree</em> files will be located in the
 <em>/arch/&lt;ARCH&gt;/boot/dts/</em> folder. The bootloader has to have the capability
to load the <em>Device Tree Blob</em> and the kernel image before starting
execution of the kernel.</p>
</div>
</div>
<div class="sect2">
<h3 id="steps-to-build-and-install-a-kernel"><a class="anchor" href="#steps-to-build-and-install-a-kernel"></a>22.4. Steps To Build and Install A Kernel</h3>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>Configure the kernel source code using <em>make menuconfig</em></p>
</li>
<li>
<p>Build the kernel using <em>make</em> with &lt;ARCH&gt; and &lt;CROSS_COMPILE&gt; set if building
for and embedded platform.</p>
</li>
<li>
<p>Copy the built image from <em>arch/&lt;ARCH&gt;/boot/</em>.</p>
<div class="olist loweralpha">
<ol class="loweralpha" type="a">
<li>
<p>The image name will depend on the architecture e.g. bzImage, zImage, etc..</p>
</li>
</ol>
</div>
</li>
<li>
<p>Install the kernel image. For an embedded platform do <strong>NOT</strong> run <em>make install</em>.
It is better to simply copy the built kernel image.</p>
<div class="olist loweralpha">
<ol class="loweralpha" type="a">
<li>
<p>The installation can be customized by editing the <em>arch/&lt;ARCH&gt;/boot/install.sh</em>
script.</p>
</li>
</ol>
</div>
</li>
<li>
<p>Install the modules. For an embedded platform do <strong>NOT</strong> run <em>make modules_install</em>
without the <em>INSTALL_MOD_PATH=&lt;dir&gt;/</em> variable. This ensures we don&#8217;t mess around
with the system kernel modules.</p>
</li>
</ol>
</div>
</div>
<div class="sect2">
<h3 id="using-u-boot"><a class="anchor" href="#using-u-boot"></a>22.5. Using U-Boot</h3>
<div class="paragraph">
<p>A popular bootloader with embedded platforms is U-Boot. U-Boot works with a
format of kernel image called <em>uImage</em>. This is generated from the <em>zImage</em> using
a <em>make uImage</em> target execution for ARM. Newer versions of U-Boot also support
booting of the ARM based kernel image zImage directly.</p>
</div>
<div class="paragraph">
<p>Some ARM platforms require the LOADADDR to be passed along with the <em>make uImage</em>
target execution. The address associated with this variable represents the
physical memory where the image is executed in.</p>
</div>
<div class="paragraph">
<p>U-Boot also has the ability to load the <em>Device Tree Blob</em> in memory and pass
it to the kernel. The boot process follows the steps</p>
</div>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>Load the kernel zImage or uImage at address X</p>
</li>
<li>
<p>Load the &lt;board&gt;.dtb file at Y</p>
</li>
<li>
<p>Boot the kernel with bootz X -Y or bootm X - Y. The - indicates no initramfs.</p>
</li>
</ol>
</div>
</div>
<div class="sect2">
<h3 id="kernel-command-line"><a class="anchor" href="#kernel-command-line"></a>22.6. Kernel Command Line</h3>
<div class="paragraph">
<p>The kernel takes in a list of arguments which can affect its behavior at run
time. These argument can be hardcoded during the configuration of the kernel
source code by setting the CONFIG_CMDLINE option.</p>
</div>
<div class="paragraph">
<p>The command line argument can also be passed to the kernel at boot up using
an environment variable like <em>bootargs</em> in the case of U-Boot.</p>
</div>
<div class="paragraph">
<p>There are several kernel arguments documented in
<em>Documentation/kernel-parameters.txt</em>. We typically set:</p>
</div>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>root =  for the root filesystem</p>
</li>
<li>
<p>console = for the destination of the kernel messages</p>
</li>
</ol>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="lab-2-setting-up-the-beaglebone-black-board"><a class="anchor" href="#lab-2-setting-up-the-beaglebone-black-board"></a>23. LAB 2 : Setting Up The Beaglebone Black Board</h2>
<div class="sectionbody">
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
<div class="title">This is a hands on session taken from the Free Electrons labs with the following objectives</div>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>Getting familiar with the BeagleBone Black board</p>
</li>
<li>
<p>Knowing what technical documentation is available</p>
</li>
<li>
<p>Installing the lab data from Free Electrons</p>
</li>
<li>
<p>Access the board through the serial line.</p>
</li>
<li>
<p>Configure the U-boot bootloader to download files onto the board using trivial
file transfer protocol (tftp)</p>
</li>
</ol>
</div>
</td>
</tr>
</table>
</div>
<div class="sect2">
<h3 id="getting-comfortable-with-the-board"><a class="anchor" href="#getting-comfortable-with-the-board"></a>23.1. Getting Comfortable With The Board</h3>
<div class="paragraph">
<p>At this point we have to get familiar with our board. It is good to go through
the features of the board given in section 4.0 of the
<a href="docs/BBB_SRM.pdf" target="_blank">BeagleBone Black System Reference Manual</a>.</p>
</div>
<div class="sect3">
<h4 id="connectors-leds-and-switches"><a class="anchor" href="#connectors-leds-and-switches"></a>23.1.1. Connectors, LEDs and Switches</h4>
<div class="exampleblock">
<div class="content">
<div id="beagleboneblacktux-CONN_REVA5A" class="imageblock" style="text-align: center">
<div class="content">
<a class="image" href="images/CONN_REVA5A.jpg"><img src="http://zeuzoix.github.io/techeuphoria/images/CONN_REVA5A.jpg" alt="CONN REVA5A" width="640" height="480"></a>
</div>
<div class="title">Beagle Bone Black Connectors, LEDs and Switches</div>
</div>
</div>
</div>
<div class="dlist">
<dl>
<dt class="hdlist1">5V DC Power Connector</dt>
<dd>
<p>The main DC input which accepts 5V power. Suitable for
more power hungry applications.</p>
</dd>
<dt class="hdlist1">Power Down Button Switch</dt>
<dd>
<p>Signals to the processor to initiate the power down
sequence. It is used to power down the board.</p>
</dd>
<dt class="hdlist1">Boot Button Switch</dt>
<dd>
<p>Force the a boot from the microSD card by removing and
reapplying power to the board.</p>
</dd>
<dt class="hdlist1">Reset Button Switch</dt>
<dd>
<p>Reset the processor.</p>
</dd>
<dt class="hdlist1">USB Client Connector</dt>
<dd>
<p>Mini USB port at the bottom of the board. It can be
used to power the board and setup a network connection.</p>
</dd>
<dt class="hdlist1">10/100 Ethernet Connector</dt>
<dd>
<p>The LAN interface.</p>
</dd>
<dt class="hdlist1">Debug Serial Header Connector</dt>
<dd>
<p>The header interface for the serial port.</p>
</dd>
<dt class="hdlist1">MicroSD Slot Connector</dt>
<dd>
<p>Slot at the bottom of the board to insert a micro SD
card.</p>
</dd>
<dt class="hdlist1">MicroHDMI Slot Connector</dt>
<dd>
<p>Slot at the bottom of the board to insert a micro
HDMI cable to interface to a display.</p>
</dd>
<dt class="hdlist1">USB Host Connector</dt>
<dd>
<p>This can be used to connect a USB device like keyboard,
mouse, BT dongle, WiFi dongle, etc..</p>
</dd>
</dl>
</div>
</div>
<div class="sect3">
<h4 id="system-key-components"><a class="anchor" href="#system-key-components"></a>23.1.2. System Key Components</h4>
<div class="exampleblock">
<div class="content">
<div id="beagleboneblacktux-COMP_A5A" class="imageblock" style="text-align: center">
<div class="content">
<a class="image" href="images/COMP_A5A.jpg"><img src="http://zeuzoix.github.io/techeuphoria/images/COMP_A5A.jpg" alt="COMP A5A" width="640" height="480"></a>
</div>
<div class="title">BeagleBone Black system key components</div>
</div>
</div>
</div>
<div class="dlist">
<dl>
<dt class="hdlist1">Sitara Processor</dt>
<dd>
<p>ARM architecture OMAP System On Chip(SOC) from
Texas Instruments. This is XAM3359AZCZ100 for revision A5A to A6A and
XAM3359AZCZ100 for revision B and above. Only the A4 revision boards had the
AM3352 processor.</p>
</dd>
<dt class="hdlist1">512MB DDR3 RAM</dt>
<dd>
<p>Micron 512MB DDR3L or Kingston 512MB DDR3 Dual Data Rate RAM.</p>
</dd>
<dt class="hdlist1">TPS65217C PMIC</dt>
<dd>
<p>It is the power management IC which supplies the power rails
to the different components on board.</p>
</dd>
<dt class="hdlist1">SMSC Ethernet PHY</dt>
<dd>
<p>The physical interface to the ethernet network.</p>
</dd>
<dt class="hdlist1">Micron eMMC</dt>
<dd>
<p>This was 2GB till revision B and changed to 4GB in revision C.</p>
</dd>
<dt class="hdlist1">HDMI Framer</dt>
<dd>
<p>Provides the HDMI control for and HDMI or DVI-D display with
adaptor.</p>
</dd>
</dl>
</div>
</div>
</div>
<div class="sect2">
<h3 id="downloading-the-technical-documentation"><a class="anchor" href="#downloading-the-technical-documentation"></a>23.2. Downloading The Technical Documentation</h3>
<div class="paragraph">
<p>Design is not possible without documentation, so we download the documents
which will help us in the lab sessions. The following are needed:</p>
</div>
<div class="paragraph">
<p>Tht System Reference Manual describes the details about the design of the
board and is available on this site <a href="docs/BBB_SRM.pdf" target="_blank">here</a><br>
The latest document should be available at: <a href="https://github.com/CircuitCo/BeagleBone-Black/blob/master/BBB_SRM.pdf?raw=true" target="_blank">https://github.com/CircuitCo/BeagleBone-Black/blob/master/BBB_SRM.pdf?raw=true</a>.</p>
</div>
<div class="paragraph">
<p>The datasheet of the TI AM335x SoCs is useful to see the PIN assignments
later when we want to configure the <em>pinmux</em> settings and is available on this
site <a href="docs/am3359.pdf" target="_blank">here</a><br>
The original link is at the TI website at: <a href="http://www.ti.com/lit/ds/symlink/am3359.pdf" target="_blank">http://www.ti.com/lit/ds/symlink/am3359.pdf</a></p>
</div>
<div class="paragraph">
<p>The last document is the Technical Reference Manual(TRM) of the TI AM335x SoCs.
At over 4000 pages it describes the internal IP design of the chip. It is available
<a href="docs/spruh73i.pdf" target="_blank">here</a>.<br>
The same document can be retrieved from the TI website at :
<a href="http://www.ti.com/product/am3359" target="_blank">http://www.ti.com/product/am3359</a></p>
</div>
</div>
<div class="sect2">
<h3 id="installing-the-free-electrons-lab-data"><a class="anchor" href="#installing-the-free-electrons-lab-data"></a>23.3. Installing The Free Electrons Lab Data</h3>
<div class="paragraph">
<p>We will be using the lab data available from Free Electrons to setup our
BeagleBone Black. First make sure the lab data is downloaded. The lab data which
was available at the time of writing this journal is
<a href="free_electrons_linux_kernel/linux-kernel-labs.tar.xz" target="_blank">here</a>.</p>
</div>
<div class="paragraph">
<p>We&#8217;ll have to uncompress the file with <strong>sudo</strong> permissions and change the
permissions of the resulting folder. The prime reason being that the package
contains system device node files for the NFS root filesystem:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="bash">conrad@conrad-HP-Pavilion-dm3-Notebook-PC:~/fe-kernel-training$ sudo tar xvJf linux-kernel-labs.tar.xz         <i class="conum" data-value="1"></i><b>(1)</b>
[sudo] password for conrad:
no talloc stackframe at ../source3/param/loadparm.c:4864, leaking memory
linux-kernel-labs/
linux-kernel-labs/src/
linux-kernel-labs/src/patches/
.
.
.
linux-kernel-labs/modules/nfsroot/sbin/route
linux-kernel-labs/modules/nfsroot/sbin/runlevel
linux-kernel-labs/git/
conrad@conrad-HP-Pavilion-dm3-Notebook-PC:~/fe-kernel-training$
conrad@conrad-HP-Pavilion-dm3-Notebook-PC:~/fe-kernel-training$ sudo chown -R conrad:conrad linux-kernel-labs        <i class="conum" data-value="2"></i><b>(2)</b>
conrad@conrad-HP-Pavilion-dm3-Notebook-PC:~/fe-kernel-training$ ls -l
total 7756
drwxrwxr-x 6 conrad conrad    4096 Mar 22 17:38 linux-kernel-labs        <i class="conum" data-value="3"></i><b>(3)</b>
-rw-rw-r-- 1 conrad conrad 7931316 Mar 22 18:57 linux-kernel-labs.tar.xz
-rw-rw-r-- 1 conrad conrad      87 Mar 22 18:55 Readme.txt</code></pre>
</div>
</div>
<div class="colist arabic">
<table>
<tr>
<td><i class="conum" data-value="1"></i><b>1</b></td>
<td>Command to untar and decompress the package</td>
</tr>
<tr>
<td><i class="conum" data-value="2"></i><b>2</b></td>
<td>Command to change the owner and group to the user name in this case <em>conrad</em></td>
</tr>
<tr>
<td><i class="conum" data-value="3"></i><b>3</b></td>
<td>Listing of the directory shows the owner and group has been set appropriately</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>The xz extension of the package indicates that it requires XZ compression utility
which if not available on your system can be upgraded as follows:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="bash">conrad@conrad-HP-Pavilion-dm3-Notebook-PC:~/fe-kernel-training$ sudo apt-get install xz-utils</code></pre>
</div>
</div>
</div>
<div class="sect2">
<h3 id="making-a-bootable-microsd-card"><a class="anchor" href="#making-a-bootable-microsd-card"></a>23.4. Making A Bootable MicroSD Card</h3>
<div class="paragraph">
<p>Now we deviate slightly from the Free Electrons lab slides and first
prepare our board as per the instructions provided in the
<em>linux-kernel-labs/bootloader/beaglebone-black/README.txt</em> file. The
bootable micro-SD card will automatically format the on board eMMC
device.</p>
</div>
<div class="paragraph">
<p>Take the microSD card and insert it into a microSD adapter like the
one shown in the image below:</p>
</div>
<div class="exampleblock">
<div class="content">
<div id="beagleboneblacktux-microsd-adaptor-sd" class="imageblock" style="text-align: center">
<div class="content">
<a class="image" href="images/sdcard-microsd-adaptor-sd.jpg"><img src="http://zeuzoix.github.io/techeuphoria/images/sdcard-microsd-adaptor-sd.jpg" alt="sdcard microsd adaptor sd" width="640" height="480"></a>
</div>
<div class="title">Micro SD card adapter</div>
</div>
</div>
</div>
<div class="paragraph">
<p>This memory card reader/adapter should be inserted into the SD card
slot available. If your system has a micro SD card slot then please
use that directly. On checking the kernel logs with <em>dmesg</em> we should
be able to identify the card detected in the system. If a micro SD
card slot is available then the system should register it as a
<em>/dev/mmcblk0</em> whereas in this case with a memory card reader we see
it as <em>/dev/sdb</em>. The following shows the kernel logs:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="bash">conrad@conrad-HP-Pavilion-dm3-Notebook-PC:~/fe-kernel-training$ dmesg
.
.
.
[127595.272118] usb 1-2: new high-speed USB device number 6 using ehci-pci
[127595.405640] usb 1-2: New USB device found, idVendor=058f, idProduct=6366
[127595.405650] usb 1-2: New USB device strings: Mfr=1, Product=2, SerialNumber=3
[127595.405658] usb 1-2: Product: Mass Storage Device
[127595.405665] usb 1-2: Manufacturer: Generic
[127595.405671] usb 1-2: SerialNumber: 058F63666433
[127595.406226] usb-storage 1-2:1.0: USB Mass Storage device detected
[127595.407830] scsi9 : usb-storage 1-2:1.0
[127596.532963] scsi 9:0:0:0: Direct-Access     Multiple Card  Reader     1.00 PQ: 0 ANSI: 0
[127596.533754] sd 9:0:0:0: Attached scsi generic sg1 type 0
[127598.192274] sd 9:0:0:0: [sdb] 7744512 512-byte logical blocks: (3.96 GB/3.69 GiB) <i class="conum" data-value="1"></i><b>(1)</b>
[127598.193263] sd 9:0:0:0: [sdb] Write Protect is off
[127598.193269] sd 9:0:0:0: [sdb] Mode Sense: 03 00 00 00
[127598.194256] sd 9:0:0:0: [sdb] No Caching mode page found
[127598.194259] sd 9:0:0:0: [sdb] Assuming drive cache: write through
[127598.199023] sd 9:0:0:0: [sdb] No Caching mode page found
[127598.199028] sd 9:0:0:0: [sdb] Assuming drive cache: write through
conrad@conrad-HP-Pavilion-dm3-Notebook-PC:~/fe-kernel-training$ ls -l /dev/sdb         <i class="conum" data-value="2"></i><b>(2)</b>
brw-rw---- 1 root disk 8, 16 Mar 22 21:09 /dev/sdb</code></pre>
</div>
</div>
<div class="colist arabic">
<table>
<tr>
<td><i class="conum" data-value="1"></i><b>1</b></td>
<td>We see the device attached as sdb</td>
</tr>
<tr>
<td><i class="conum" data-value="2"></i><b>2</b></td>
<td>The device node has been created successfully as /dev/sdb</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>We will have to first partition the micro SD card using the <em>sfdisk</em> utility
which is part of the <em>util-linux</em> APT package.
This tool helps us to list the partitions of a device, check the sizes of the
partitions, check the partitions on a device and re-partition a device. We must
<strong>be extra careful</strong> when we use such a tool as it could also cause damage to our
workstation system if we select the wrong device file unintentionally.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="bash">conrad@conrad-HP-Pavilion-dm3-Notebook-PC:~/Git/techeuphoria$ sudo sfdisk --in-order --Linux --unit M /dev/sdb &lt;&lt; EOF                <i class="conum" data-value="1"></i><b>(1)</b>
&gt; 1,48,0xE,*
&gt; ,,,-
&gt; EOF
Checking that no-one is using this disk right now ...
BLKRRPART: Device or resource busy                                                <i class="conum" data-value="2"></i><b>(2)</b>

This disk is currently in use - repartitioning is probably a bad idea.
Umount all file systems, and swapoff all swap partitions on this disk.
Use the --no-reread flag to suppress this check.
Use the --force flag to overrule all checks.
conrad@conrad-HP-Pavilion-dm3-Notebook-PC:~/Git/techeuphoria$ mount                <i class="conum" data-value="3"></i><b>(3)</b>
/dev/sda1 on / type ext4 (rw,errors=remount-ro)
proc on /proc type proc (rw,noexec,nosuid,nodev)
sysfs on /sys type sysfs (rw,noexec,nosuid,nodev)
none on /sys/fs/cgroup type tmpfs (rw)
none on /sys/fs/fuse/connections type fusectl (rw)
none on /sys/kernel/debug type debugfs (rw)
none on /sys/kernel/security type securityfs (rw)
udev on /dev type devtmpfs (rw,mode=0755)
devpts on /dev/pts type devpts (rw,noexec,nosuid,gid=5,mode=0620)
tmpfs on /run type tmpfs (rw,noexec,nosuid,size=10%,mode=0755)
none on /run/lock type tmpfs (rw,noexec,nosuid,nodev,size=5242880)
none on /run/shm type tmpfs (rw,nosuid,nodev)
none on /run/user type tmpfs (rw,noexec,nosuid,nodev,size=104857600,mode=0755)
none on /sys/fs/pstore type pstore (rw)
rpc_pipefs on /run/rpc_pipefs type rpc_pipefs (rw)
binfmt_misc on /proc/sys/fs/binfmt_misc type binfmt_misc (rw,noexec,nosuid,nodev)
systemd on /sys/fs/cgroup/systemd type cgroup (rw,noexec,nosuid,nodev,none,name=systemd)
nfsd on /proc/fs/nfsd type nfsd (rw)
gvfsd-fuse on /run/user/1000/gvfs type fuse.gvfsd-fuse (rw,nosuid,nodev,user=conrad)
/dev/sdb1 on /media/conrad/boot type vfat (rw,nosuid,nodev,uid=1000,gid=1000,shortname=mixed,dmask=0077,utf8=1,showexec,flush,uhelper=udisks2) <i class="conum" data-value="4"></i><b>(4)</b></code></pre>
</div>
</div>
<div class="colist arabic">
<table>
<tr>
<td><i class="conum" data-value="1"></i><b>1</b></td>
<td>The command to re-partition the <em>/devsdb</em> device with <em>sfdisk</em>. The options
<em>--in-order</em> indicates that the partitions are in order in the input. <em>--Linux</em>
tells sfdisk to ignore all warnings irrelevant for Linux.</td>
</tr>
<tr>
<td><i class="conum" data-value="2"></i><b>2</b></td>
<td>The device is apparently busy.</td>
</tr>
<tr>
<td><i class="conum" data-value="3"></i><b>3</b></td>
<td>We do a <em>mount</em> to check if it is mounted</td>
</tr>
<tr>
<td><i class="conum" data-value="4"></i><b>4</b></td>
<td>We see that a partition is mounted in our Workstation at /media/conrad/boot</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>If the micro-SD card is already partitioned and formated it may be auto mounted
by our work station. We will have to un-mount all the partitions before we can
proceed.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="bash">conrad@conrad-HP-Pavilion-dm3-Notebook-PC:~/Git/techeuphoria$ sudo umount /media/conrad/boot         <i class="conum" data-value="1"></i><b>(1)</b>
[sudo] password for conrad:
no talloc stackframe at ../source3/param/loadparm.c:4864, leaking memory
conrad@conrad-HP-Pavilion-dm3-Notebook-PC:~/Git/techeuphoria$ mount                <i class="conum" data-value="2"></i><b>(2)</b>
/dev/sda1 on / type ext4 (rw,errors=remount-ro)
proc on /proc type proc (rw,noexec,nosuid,nodev)
sysfs on /sys type sysfs (rw,noexec,nosuid,nodev)
none on /sys/fs/cgroup type tmpfs (rw)
none on /sys/fs/fuse/connections type fusectl (rw)
none on /sys/kernel/debug type debugfs (rw)
none on /sys/kernel/security type securityfs (rw)
udev on /dev type devtmpfs (rw,mode=0755)
devpts on /dev/pts type devpts (rw,noexec,nosuid,gid=5,mode=0620)
tmpfs on /run type tmpfs (rw,noexec,nosuid,size=10%,mode=0755)
none on /run/lock type tmpfs (rw,noexec,nosuid,nodev,size=5242880)
none on /run/shm type tmpfs (rw,nosuid,nodev)
none on /run/user type tmpfs (rw,noexec,nosuid,nodev,size=104857600,mode=0755)
none on /sys/fs/pstore type pstore (rw)
rpc_pipefs on /run/rpc_pipefs type rpc_pipefs (rw)
binfmt_misc on /proc/sys/fs/binfmt_misc type binfmt_misc (rw,noexec,nosuid,nodev)
systemd on /sys/fs/cgroup/systemd type cgroup (rw,noexec,nosuid,nodev,none,name=systemd)
nfsd on /proc/fs/nfsd type nfsd (rw)
gvfsd-fuse on /run/user/1000/gvfs type fuse.gvfsd-fuse (rw,nosuid,nodev,user=conrad)</code></pre>
</div>
</div>
<div class="colist arabic">
<table>
<tr>
<td><i class="conum" data-value="1"></i><b>1</b></td>
<td>We have to unmount the <em>/dev/sdb1</em> from the mount point i.e. <em>/media/conrad/boot</em></td>
</tr>
<tr>
<td><i class="conum" data-value="2"></i><b>2</b></td>
<td>We check to see if anything else is mounted again</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>Again we attempt to repartition the micro SD card</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="bash">conrad@conrad-HP-Pavilion-dm3-Notebook-PC:~/Git/techeuphoria$ sudo sfdisk --in-order --Linux --unit M /dev/sdb &lt;&lt; EOF
1,48,0xE,*
,,,-
EOF                                                                                        <i class="conum" data-value="1"></i><b>(1)</b>
Checking that no-one is using this disk right now ...                                        <i class="conum" data-value="2"></i><b>(2)</b>
OK

Disk /dev/sdb: 1023 cylinders, 122 heads, 62 sectors/track
Old situation:                                                                                <i class="conum" data-value="3"></i><b>(3)</b>
Units = mebibytes of 1048576 bytes, blocks of 1024 bytes, counting from 0

   Device Boot Start   End    MiB    #blocks   Id  System
/dev/sdb1   *     1     48     48      49152    e  W95 FAT16 (LBA)
/dev/sdb2        49   3780   3732    3821568   83  Linux
/dev/sdb3         0      -      0          0    0  Empty
/dev/sdb4         0      -      0          0    0  Empty
New situation:                                                                                <i class="conum" data-value="4"></i><b>(4)</b>
Units = mebibytes of 1048576 bytes, blocks of 1024 bytes, counting from 0

   Device Boot Start   End    MiB    #blocks   Id  System
/dev/sdb1   *     1     48     48      49152    e  W95 FAT16 (LBA)
/dev/sdb2        49   3780   3732    3821568   83  Linux
/dev/sdb3         0      -      0          0    0  Empty
/dev/sdb4         0      -      0          0    0  Empty
Successfully wrote the new partition table

Re-reading the partition table ...
BLKRRPART: Device or resource busy
The command to re-read the partition table failed.
Run partprobe(8), kpartx(8) or reboot your system now,
before using mkfs
If you created or changed a DOS partition, /dev/foo7, say, then use dd(1)
to zero the first 512 bytes:  dd if=/dev/zero of=/dev/foo7 bs=512 count=1
(See fdisk(8).)</code></pre>
</div>
</div>
<div class="colist arabic">
<table>
<tr>
<td><i class="conum" data-value="1"></i><b>1</b></td>
<td>The <em>sfdisk</em> utility is invoked supplying the information about the partitions</td>
</tr>
<tr>
<td><i class="conum" data-value="2"></i><b>2</b></td>
<td><em>sfdisk</em> checking to see that no one is using the disk</td>
</tr>
<tr>
<td><i class="conum" data-value="3"></i><b>3</b></td>
<td>The old partition map is displayed first. <strong>This will vary based on the history
of the micro-SD card</strong></td>
</tr>
<tr>
<td><i class="conum" data-value="4"></i><b>4</b></td>
<td>The new partition map is displayed. The first partition is a W95 FAT16 one
which is 48 MB. This is the first line of input to sfdisk. The remaining has
been converted to a Linux partition.</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>We will have to format the first partition of the disk using the <em>mkfs.vfat</em>
partition.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="bash">conrad@conrad-HP-Pavilion-dm3-Notebook-PC:~/Git/techeuphoria$ sudo mkfs.vfat -F 16 /dev/sdb1 -n boot        <i class="conum" data-value="1"></i><b>(1)</b>
[sudo] password for conrad:
no talloc stackframe at ../source3/param/loadparm.c:4864, leaking memory
mkfs.fat 3.0.26 (2014-03-07)
mkfs.fat: warning - lowercase labels might not work properly with DOS or Windows
conrad@conrad-HP-Pavilion-dm3-Notebook-PC:~/Git/techeuphoria$ echo $?                        <i class="conum" data-value="2"></i><b>(2)</b>
0</code></pre>
</div>
</div>
<div class="colist arabic">
<table>
<tr>
<td><i class="conum" data-value="1"></i><b>1</b></td>
<td><em>mkfs.vfat</em> is run on the partition <em>/dev/sdb1</em>. The label of the partition
is set to <em>boot</em> with the -n option and the -F option specifies the type of
file allocation tables used (12, 16 or 32 bit).</td>
</tr>
<tr>
<td><i class="conum" data-value="2"></i><b>2</b></td>
<td>Checks the return value of the command</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>We now remove and re-insert the microSD card into the system to see if it gets
detected and automatically mounted. It does and we see that Ubuntu
opens up the directory located in <em>/media/conrad/boot</em>.</p>
</div>
<div class="exampleblock">
<div class="content">
<div id="beagleboneblacktux-media-boot-automounted" class="imageblock" style="text-align: center">
<div class="content">
<a class="image" href="images/beagleboneblacktux-media-boot-automounted.png"><img src="http://zeuzoix.github.io/techeuphoria/images/beagleboneblacktux-media-boot-automounted.png" alt="beagleboneblacktux media boot automounted" width="640" height="480"></a>
</div>
<div class="title">The first partition <em>/dev/sdb1</em> has been automounted successfully at <em>/media/conrad/boot</em></div>
</div>
</div>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="bash">conrad@conrad-HP-Pavilion-dm3-Notebook-PC:~/Git/techeuphoria$ mount        <i class="conum" data-value="1"></i><b>(1)</b>
/dev/sda1 on / type ext4 (rw,errors=remount-ro)
proc on /proc type proc (rw,noexec,nosuid,nodev)
sysfs on /sys type sysfs (rw,noexec,nosuid,nodev)
none on /sys/fs/cgroup type tmpfs (rw)
none on /sys/fs/fuse/connections type fusectl (rw)
none on /sys/kernel/debug type debugfs (rw)
none on /sys/kernel/security type securityfs (rw)
udev on /dev type devtmpfs (rw,mode=0755)
devpts on /dev/pts type devpts (rw,noexec,nosuid,gid=5,mode=0620)
tmpfs on /run type tmpfs (rw,noexec,nosuid,size=10%,mode=0755)
none on /run/lock type tmpfs (rw,noexec,nosuid,nodev,size=5242880)
none on /run/shm type tmpfs (rw,nosuid,nodev)
none on /run/user type tmpfs (rw,noexec,nosuid,nodev,size=104857600,mode=0755)
none on /sys/fs/pstore type pstore (rw)
rpc_pipefs on /run/rpc_pipefs type rpc_pipefs (rw)
binfmt_misc on /proc/sys/fs/binfmt_misc type binfmt_misc (rw,noexec,nosuid,nodev)
systemd on /sys/fs/cgroup/systemd type cgroup (rw,noexec,nosuid,nodev,none,name=systemd)
nfsd on /proc/fs/nfsd type nfsd (rw)
gvfsd-fuse on /run/user/1000/gvfs type fuse.gvfsd-fuse (rw,nosuid,nodev,user=conrad)
/dev/sdb1 on /media/conrad/boot type vfat (rw,nosuid,nodev,uid=1000,gid=1000,shortname=mixed,dmask=0077,utf8=1,showexec,flush,uhelper=udisks2)        <i class="conum" data-value="2"></i><b>(2)</b></code></pre>
</div>
</div>
<div class="colist arabic">
<table>
<tr>
<td><i class="conum" data-value="1"></i><b>1</b></td>
<td>We use <em>mount</em> to check explicitly what&#8217;s there in the system</td>
</tr>
<tr>
<td><i class="conum" data-value="2"></i><b>2</b></td>
<td>Our partition has been mounted at <em>/media/conrad/boot</em></td>
</tr>
</table>
</div>
<div class="paragraph">
<p>We will finally have to copy the files from the lab data folder to this partition
and un mount the device.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="bash">conrad@conrad-HP-Pavilion-dm3-Notebook-PC:~/fe-kernel-training/linux-kernel-labs/bootloader/beaglebone-black$ cp am335x-boneblack.dtb MLO MBR u-boot.img MLO.final u-boot.img.final uEnv.txt uImage /media/conrad/boot/                <i class="conum" data-value="1"></i><b>(1)</b>
conrad@conrad-HP-Pavilion-dm3-Notebook-PC:~/fe-kernel-training/linux-kernel-labs/bootloader/beaglebone-black$ umount /media/conrad/boot        <i class="conum" data-value="2"></i><b>(2)</b></code></pre>
</div>
</div>
<div class="colist arabic">
<table>
<tr>
<td><i class="conum" data-value="1"></i><b>1</b></td>
<td>Copying the necessary files from the Free Electrons lab data folder which we unpacked earlier</td>
</tr>
<tr>
<td><i class="conum" data-value="2"></i><b>2</b></td>
<td>Unmounting the mounted partition</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>We can now safely eject or remove the microSD card from the work station.</p>
</div>
</div>
</div>
</div>
</div>
</div>
<footer class="row" style="max-width: 100%">
<hr>
<div class="large-6 columns">
<p style="margin-bottom: .75em">
&copy; conrad.s.j.gomes@gmail.com 2015
<br>
Built on Foundation. Baked by Awestruct. Composed with Asciidoc
</p>
</div>
<div class="large-6 columns">
<ul class="inline-list right">
<li>
<a href="http://zeuzoix.github.io/techeuphoria/">Home</a>
</li>
</ul>
</div>
</footer>
<script>
document.write('<script src=' + ('__proto__' in {} ? 'http://zeuzoix.github.io/techeuphoria/javascripts/vendor/zepto' : 'http://zeuzoix.github.io/techeuphoria/javascripts/vendor/jquery') + '.js><\/script>')
</script>
<script src="http://zeuzoix.github.io/techeuphoria/javascripts/foundation/foundation.js"></script>
<script src="http://zeuzoix.github.io/techeuphoria/javascripts/foundation/foundation.topbar.js"></script>
<script>
$(document).foundation()
</script>
</body>
</html>
